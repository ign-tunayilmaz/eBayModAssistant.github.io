<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eBay Moderation Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Using cdnjs for better reliability -->
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  </head>
  <body>
    <style>
      input[type="number"]::-webkit-inner-spin-button,
      input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }

      input[type="number"] {
        -moz-appearance: textfield;
      }
    </style>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Simple icon components using SVG
        const ChevronDown = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
            </svg>
        );

        const ChevronUp = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 15l7-7 7 7" />
            </svg>
        );

        const Copy = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
            </svg>
        );

        const Check = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
            </svg>
        );

        const Plus = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
            </svg>
        );

        const Minus = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20 12H4" />
            </svg>
        );

        const Sun = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
            </svg>
        );

        const Moon = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
            </svg>
        );

        // Additional icons for AI features
        const Download = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
            </svg>
        );

        const Sparkles = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
            </svg>
        );

        const Trash2 = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
        );

        const ServerCog = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
        );

        const Wifi = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0" />
            </svg>
        );

        const WifiOff = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.25 6.75L22.5 12l-5.25 5.25m0-10.5L12 12.75l5.25 5.25M1.5 12l5.25-5.25L12 12.75" />
            </svg>
        );

        const FileText = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
        );

        const ModerationTool = () => {
            // State for collapsed menus (all false by default)
            const [showAdditionalTemplates, setShowAdditionalTemplates] = useState(false);
            const [showBanTemplates, setShowBanTemplates] = useState(false);
            const [showGuidelines, setShowGuidelines] = useState(false);
            const [showWorkflows, setShowWorkflows] = useState(false);
            const [showAdminNotes, setShowAdminNotes] = useState(false);
            const [showFAQ, setShowFAQ] = useState(false);
            const [showAI, setShowAI] = useState(false);
            const [showKeyboardShortcuts, setShowKeyboardShortcuts] = useState(false);
            const [expandedGuidelines, setExpandedGuidelines] = useState({});
            const [guidelinesSearch, setGuidelinesSearch] = useState('');



            // Training data collection state
            const [trainingData, setTrainingData] = useState({
                instanceCount: 0,
                trainingInstances: []
            });
            const [darkMode, setDarkMode] = useState(false);
            const [activeAction, setActiveAction] = useState(null);
            const [expandedTemplates, setExpandedTemplates] = useState({});
            const [expandedFAQ, setExpandedFAQ] = useState({});
            const [templateSearch, setTemplateSearch] = useState('');
            
            // AI Assistant state
            const [apiBase, setApiBase] = useState("");
            const [apiKey, setApiKey] = useState("");
            const [goLive, setGoLive] = useState(false);
            const [liveStatus, setLiveStatus] = useState("offline");
            const [aiPost, setAiPost] = useState("");
            const [aiPriority, setAiPriority] = useState("P3");
            const [aiSuggestion, setAiSuggestion] = useState(null);
            const [aiFinalAction, setAiFinalAction] = useState("");
            const [aiPostDateTime, setAiPostDateTime] = useState("");
            const [aiSaved, setAiSaved] = useState([]);
            const [busySuggest, setBusySuggest] = useState(false);
            const [errorSuggest, setErrorSuggest] = useState("");
            const [groundTruthNotes, setGroundTruthNotes] = useState([]);
            const [manPriority, setManPriority] = useState("P4");
            const [manAction, setManAction] = useState("NAR");
            const [aiActiveTab, setAiActiveTab] = useState("queue");
            const [testResults, setTestResults] = useState([]);
            const [isRunningTests, setIsRunningTests] = useState(false);
            
            // Counter state
            const [counters, setCounters] = useState({
                P1: { NAR: 0, Edit: 0, Steer: 0, Remove: 0, Ban: 0, Locked: 0, Moved: 0 },
                P2: { NAR: 0, Edit: 0, Steer: 0, Remove: 0, Ban: 0, Locked: 0, Moved: 0 },
                P3: { NAR: 0, Edit: 0, Steer: 0, Remove: 0, Ban: 0, Locked: 0, Moved: 0 },
                P4: { NAR: 0, Edit: 0, Steer: 0, Remove: 0, Ban: 0, Locked: 0, Moved: 0 }
            });

            const [templateInputs, setTemplateInputs] = useState({
                friendlyRemovedPost: { url: '', username: '', title: '', datetime: '', guidelines: '', quote: '' },
                warningRemovedPost: { url: '', username: '', title: '', datetime: '', guidelines: '', quote: '' },
                friendlyEditedPost: { url: '', username: '', title: '', guidelines: '', quote: '' },
                warningEditedPost: { url: '', username: '', title: '', guidelines: '', quote: '' },
                csRedirect: { url: '', username: '' },
                banCombined: { url: '', banPeriod: '1 Day', reasoning: '', username: '', email: '', ip: '', spamUrl: '', startDate: '' }
            });

            const [adminNoteInputs, setAdminNoteInputs] = useState({
                edited: { link: '', removed: '', violation: '' },
                removed: { link: '', violation: '' }
            });

            const [copiedId, setCopiedId] = useState(null);
            const [openDropdown, setOpenDropdown] = useState(null);
            const [showEOSReport, setShowEOSReport] = useState(false);
            const [showResetConfirm, setShowResetConfirm] = useState(false);
            const dropdownRefs = useRef({});
            
            // Keyboard shortcuts configuration
            const [keyboardShortcuts, setKeyboardShortcuts] = useState({
                p1Nar: { ctrl: true, alt: false, key: '1', action: 'P1 NAR', description: 'Increase P1 NAR counter' },
                p2Nar: { ctrl: true, alt: false, key: '2', action: 'P2 NAR', description: 'Increase P2 NAR counter' },
                p3Nar: { ctrl: true, alt: false, key: '3', action: 'P3 NAR', description: 'Increase P3 NAR counter' },
                p4Nar: { ctrl: true, alt: false, key: '4', action: 'P4 NAR', description: 'Increase P4 NAR counter' }
            });

            const modActionTypes = ['NAR', 'Edit', 'Steer', 'Remove', 'Ban', 'Locked', 'Moved'];
            const dropdownActionTypes = modActionTypes.filter(actionType => actionType !== 'NAR');
            const EOS_REPORT_FORM_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSdk-KjXHSklDn381qJno1knL1QpbXeonbwAtlkHajtiqIGrWQ/viewform';

            // AI constants
            const AI_SENTIMENTS = ["üôÇ", "üòê", "üò°"];
            const AI_PRIORITIES = ["P1", "P2", "P3", "P4", "P5"];
            const AI_ACTIONS = ["NAR", "Edit", "Steer", "Remove", "Ban", "Locked", "Moved"];
            const VIOLATION_LEVELS = ["None", "Minor", "Moderate", "Major"];
            const BAN_LENGTHS = ["None", "1d", "3d", "7d", "30d", "Indefinite"];

            // AI utility functions
            const uid = () => (globalThis.crypto?.randomUUID?.() ?? Math.random().toString(36).slice(2));

            const localSuggest = (post, priority) => {
                const lowered = (post || "").toLowerCase();
                const original = post || "";
                let violation = "None";
                let action = "NAR";
                let sentiment = "üôÇ";
                let ban_length = "None";
                let rationale = "Post appears to comply with community guidelines.";
                let message_to_user = "";

                // MAJOR violations (Ban/Remove)
                if (/(kill|murder|hurt|beat you up|violence|assault|attack you)/.test(lowered)) {
                    violation = "Major"; action = "Ban"; sentiment = "üò°"; ban_length = "7d";
                    rationale = "Direct threats of violence or harm detected. This violates eBay's zero-tolerance policy on threats.";
                    message_to_user = "Your post contained threats of violence, which strictly violate our community guidelines. This behavior is not tolerated.";
                } else if (/(fuck|shit|bitch|asshole|damn you|go to hell)/.test(lowered) && !(/\*/.test(original))) {
                    violation = "Major"; action = "Ban"; sentiment = "üò°"; ban_length = "1d";
                    rationale = "Severe profanity and abusive language directed at community members.";
                    message_to_user = "Your post contained severe inappropriate language that creates a hostile environment.";
                } else if (/(scam|fraud|steal|cheat|ripoff).*(ebay|seller|buyer)/.test(lowered)) {
                    violation = "Major"; action = "Remove"; sentiment = "üò°";
                    rationale = "Accusations of fraud/scamming without evidence can be defamatory and harmful.";
                    message_to_user = "Please contact eBay directly for transaction disputes rather than making public accusations.";
                
                // MODERATE violations (Edit/Steer) - CONTEXT-AWARE PERSONAL INFO DETECTION
                } else if (/(phone|call me|\d{3}[-.\s]?\d{3}[-.\s]?\d{4}|\+\d{10,})/.test(lowered)) {
                    // Context-aware phone number detection
                    if (/(what.*(ebay|ebays?).*(phone|number)|does.*ebay.*have.*phone|ebay.*phone.*number|ebay.*doesn.*have.*phone|no.*phone.*number.*ebay)/.test(lowered)) {
                        // Asking about eBay's phone number or stating eBay doesn't have one ‚Üí NAR
                        violation = "None"; action = "NAR"; sentiment = "üòä";
                        rationale = "User discussing eBay's contact methods - no personal info shared.";
                        message_to_user = "";
                    } else if (/(call me|contact me|reach me|phone me).*(\d{3}[-.\s]?\d{3}[-.\s]?\d{4}|\+\d{10,})/.test(lowered)) {
                        // Actually sharing their phone number for contact ‚Üí Edit
                        violation = "Moderate"; action = "Edit"; sentiment = "üòê";
                        rationale = "Personal contact information (phone number) shared publicly violates privacy guidelines.";
                        message_to_user = "We removed your phone number from the post. Please use eBay's messaging system for contact.";
                    } else {
                        // General phone discussion ‚Üí NAR
                        violation = "None"; action = "NAR"; sentiment = "üòä";
                        rationale = "General discussion about phone numbers without sharing personal contact info.";
                        message_to_user = "";
                    }
                } else if (/(email|gmail|yahoo|hotmail|@\w+\.\w+)/.test(lowered)) {
                    // Context-aware email detection
                    if (/(my.*email.*(not|isn.*t|didn.*t|won.*t).*(get|getting|receive|receiving|come|coming)|email.*(not|isn.*t|didn.*t|won.*t).*(work|working)|nothing.*came.*to.*my.*email|email.*address.*not.*working)/.test(lowered)) {
                        // Discussing email delivery issues without revealing email ‚Üí NAR
                        violation = "None"; action = "NAR"; sentiment = "üòä";
                        rationale = "User discussing email delivery issues without sharing personal contact information.";
                        message_to_user = "";
                    } else if (/(my.*address|my.*email.*address|package.*didn.*t.*arrive|nothing.*delivered|delivery.*issue)/.test(lowered) && !/@\w+\.\w+/.test(original)) {
                        // Discussing delivery to address without revealing it ‚Üí NAR
                        violation = "None"; action = "NAR"; sentiment = "üòä";
                        rationale = "User discussing delivery issues without sharing personal address information.";
                        message_to_user = "";
                    } else if (/(contact.*me.*at|email.*me.*at|reach.*me.*at|send.*me.*email).*@\w+\.\w+/.test(lowered)) {
                        // Actually sharing email for contact ‚Üí Edit
                        violation = "Moderate"; action = "Edit"; sentiment = "üòê";
                        rationale = "Email addresses should not be shared publicly on the community.";
                        message_to_user = "We removed your email address. Please use eBay's private messaging system for contact.";
                    } else {
                        // General email discussion ‚Üí NAR
                        violation = "None"; action = "NAR"; sentiment = "üòä";
                        rationale = "General discussion about email without sharing personal contact information.";
                        message_to_user = "";
                    }
                } else if (/(mods? suck|ebay sucks|corrupt|useless|incompetent)/.test(lowered)) {
                    violation = "Moderate"; action = "Edit"; sentiment = "üò°";
                    rationale = "Hostile language towards eBay staff/moderators disrupts community atmosphere.";
                    message_to_user = "We edited your post to remove hostile language. Please keep feedback constructive and respectful.";
                } else if (/\*+bleep\*+|\*{2,}|f\*\*k|s\*\*t/.test(original)) {
                    violation = "Moderate"; action = "Edit"; sentiment = "üò°";
                    rationale = "Profanity (even censored) should be edited to maintain professional discussion.";
                    message_to_user = "We edited your post to remove inappropriate language to keep discussions civil.";
                } else if (/(stupid|idiot|moron|dumb|retard)/.test(lowered)) {
                    violation = "Moderate"; action = "Edit"; sentiment = "üò°";
                    rationale = "Personal attacks and name-calling degrade community discussion quality.";
                    message_to_user = "We edited your post to remove personal attacks. Please focus on the topic, not the person.";

                // MINOR violations (Steer/Lock)
                } else if (/(http|www\.|\.com|check out my|buy from me|visit my store)/.test(lowered)) {
                    violation = "Minor"; action = "Steer"; sentiment = "üòê";
                    rationale = "Promotional content or external links detected. Community is for discussion, not advertising.";
                    message_to_user = "Please avoid promotional content in community discussions. Focus on helping other members.";
                } else if (/(off.?topic|this is stupid|waste of time|who cares)/.test(lowered)) {
                    violation = "Minor"; action = "Steer"; sentiment = "üòê";
                    rationale = "Post appears to be off-topic or non-contributory to the discussion.";
                    message_to_user = "Please keep discussions on-topic and constructive to help other community members.";
                } else if (/(arguing|heated|fight|flame war|getting personal)/.test(lowered)) {
                    violation = "Minor"; action = "Lock"; sentiment = "üòê";
                    rationale = "Discussion shows signs of becoming heated or argumentative.";
                    message_to_user = "This discussion is being locked to prevent it from becoming unproductive.";
                } else if (/(duplicate|already asked|spam|repeat)/.test(lowered) && post.length < 50) {
                    violation = "Minor"; action = "Remove"; sentiment = "üòê";
                    rationale = "Appears to be duplicate or low-effort content.";
                    message_to_user = "Please search existing discussions before posting to avoid duplicates.";

                // SPECIAL CASES
                } else if (/(help|question|how to|can someone|please)/.test(lowered) && post.length > 20) {
                    violation = "None"; action = "NAR"; sentiment = "üôÇ";
                    rationale = "Legitimate help-seeking post that contributes to community knowledge sharing.";
                } else if (/(thank|thanks|solved|helpful|appreciate)/.test(lowered)) {
                    violation = "None"; action = "NAR"; sentiment = "üôÇ";
                    rationale = "Positive community interaction showing gratitude and engagement.";
                } else if (post.length < 10) {
                    violation = "Minor"; action = "Steer"; sentiment = "üòê";
                    rationale = "Very short post may not provide sufficient context or value.";
                    message_to_user = "Please provide more detail in your posts to help other community members.";
                }

                // Priority-based adjustments
                if (priority === "P1") {
                    if (violation === "None") {
                        violation = "Minor"; 
                        rationale = "Flagged as P1 (abuse report) - requires careful review even if no obvious violation detected.";
                    } else {
                        rationale += " HIGH PRIORITY: Flagged as P1 abuse report requiring immediate attention.";
                    }
                } else if (priority === "P2" && violation !== "None") {
                    rationale += " Moderate priority flag - likely repeat offender or escalated issue.";
                }

                // Handle empty/very short posts
                if (!post.trim()) {
                    violation = "Minor"; action = "Remove"; sentiment = "üòê";
                    rationale = "Empty post provides no value to community discussion.";
                    message_to_user = "Empty posts are automatically removed to maintain discussion quality.";
                }

                return { violation, action, sentiment, rationale, ban_length, message_to_user, admin_note: "Enhanced local AI analysis" };
            };

            const callModerationAPI = async ({ baseUrl, apiKey, post_text, priority }) => {
                // Claude AI integration
                if (!apiKey) {
                    throw new Error("Claude API key not configured. Please check your settings.");
                }

                // Claude system prompt for eBay moderation
                const systemPrompt = `You are an expert eBay Community Moderation Assistant trained on official eBay Community Guidelines and professional moderation practices.

ALWAYS respond with valid JSON in this exact format:
{
  "violation": "Severe|Moderate|Minor|None",
  "action": "NAR|Edit|Steer|Remove|Ban|Locked|Moved",
  "sentiment": "üò†|üòê|üòä",
  "rationale": "Brief explanation of why this action is recommended",
  "ban_length": "1 Day|3 Days|7 Days|30 Days|Indefinite|None",
  "message_to_user": "Template message for user notification",
  "admin_note": "Internal note for moderation log"
}

eBay Community Guidelines - Key Violations:
- Spam, advertising, or promotional content
- Profanity, harassment, or offensive language
- Personal information sharing (emails, phones, addresses) - CONTEXT MATTERS
- Off-topic discussions or necroposting (6+ months old)
- Duplicate posts or repetitive content
- Threats, adult content, or illegal activities
- Misinformation or misleading content

IMPORTANT CONTEXT RULES FOR PERSONAL INFORMATION:
- EDIT when users share actual contact details: "Call me at 555-1234", "Email me at john@gmail.com"
- NAR when discussing eBay's contact info: "What's eBay's phone number?", "eBay doesn't have a phone number"
- NAR when describing delivery issues: "Nothing came to my email address", "Package didn't arrive at my address"
- NAR when asking about notifications: "My email isn't getting eBay alerts", "Address confirmation emails"
- NAR when discussing general concepts: "phone number format", "email address requirements"

AVAILABLE MODERATION ACTIONS (match EOS report tracking):
- NAR: No Action Required (post complies with guidelines)
- Edit: Edit post to remove violating content but preserve main message
- Steer: Redirect discussion, lock heated threads, guide behavior
- Remove: Delete post entirely (spam, severe violations)
- Ban: Temporarily or permanently restrict user access
- Locked: Lock thread from further replies (use for necroposting, heated discussions)
- Moved: Move post/thread to appropriate board or category

CRITICAL P1 PRIORITY RULES - REAL-WORLD WORKFLOW:
1. NECROPOSTING TAKES PRECEDENCE: Thread >6 months old ‚Üí action=Locked, use "Locking: Necro Thread" template, ignore all other violations
2. PRIVACY VIOLATIONS: Screenshots/images with personal info ‚Üí action=Edit, QUOTE="A screenshot containing buyer's full address" (descriptive for non-text)
3. HOSTILE INSULTS: Personal attacks/sarcastic hostility ‚Üí action=Remove, use Friendly PM for first offense (not Warning unless repeat)
4. MISPLACED CONTENT: Posts in wrong board ‚Üí action=Moved, note target board in rationale
5. MULTIPLE VIOLATIONS: Prioritize necro > privacy > hostility > content quality

P1 RESOLUTION WORKFLOW:
Step 1: Check thread age first (>6 months = Locked, done)
Step 2: Check for privacy exposure (personal info in screenshots/images = Edit)
Step 3: Assess hostility level (insults/attacks = Remove with Friendly PM)
Step 4: Check placement (wrong board = Moved)
Step 5: Apply standard violation rules

TEMPLATE POPULATION RULES (CRITICAL):
- USERNAME = violator's username (NOT the reporter who filed the abuse report)
- TITLE = full post title in quotes for "Edited Post" templates, no [HERE] placeholder
- DATE_TIME = exact format from post (e.g., "‚Äé11-09-2025 08:03 PM")
- GUIDELINES = description text ONLY (remove "GG01:", "SG10:" etc - just the text)
- QUOTE = actual removed text OR descriptive for images: "A screenshot containing buyer's full address"

P1 TONE GUIDELINES:
- First offense hostile language ‚Üí Friendly PM (educational, not punitive)
- Unintentional privacy violations ‚Üí Friendly PM (user likely didn't realize)
- Self-reports (user flagging their own mistake) ‚Üí still apply standard action
- Repeat violations or severe content ‚Üí Warning PM or escalate to ban`;

                // Get global learning context
                let learningContext = "";
                try {
                    const response = await fetch('/api/learning-patterns/summary');
                    if (response.ok) {
                        const summary = await response.json();
                        if (summary.totalAnalyses > 0) {
                            learningContext = `\nGlobal Team Learning Context (${summary.totalAnalyses} interactions):
- Team accuracy: ${summary.globalAccuracy}%
- Common corrections: ${summary.commonCorrections.join(', ')}
- Top override patterns: ${summary.topOverrides.join(', ')}`;
                            
                            // Include expert rules for immediate intelligence
                            if (summary.expertRules?.personalInfoContext) {
                                learningContext += `\n- EXPERT RULE - Personal Info Context: When users mention "phone number", "email", or "address" - check if they're sharing actual contact details (Edit) or just discussing eBay contact info, delivery issues, or general concepts (NAR)`;
                            }
                            
                            learningContext += `\n- Last updated: ${new Date(summary.lastUpdated).toLocaleString()}`;
                        }
                    }
                } catch (error) {
                    console.warn('Could not fetch global learning context:', error);
                    // Fallback to local learning if server unavailable
                    const learningData = analyzeLearningPatterns();
                    if (learningData && aiSaved.length >= 3) {
                        learningContext += `\nLocal Learning Context:\n- Local accuracy: ${100 - learningData.overrideRate}%\n`;
                        if (Object.keys(learningData.commonOverrides).length > 0) {
                            learningContext += "- Local corrections:\n";
                            Object.entries(learningData.commonOverrides).slice(0, 3).forEach(([pattern, count]) => {
                                learningContext += `  ‚Ä¢ ${pattern} (${count}x)\n`;
                            });
                        }
                    }
                }
                            
                // Direct Claude API call
                const response = await fetch(`${baseUrl}/messages`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json", 
                        "x-api-key": apiKey,
                        "anthropic-version": "2023-06-01"
                    },
                    body: JSON.stringify({
                        model: "claude-3-5-sonnet-20241022",
                        max_tokens: 1000,
                        system: systemPrompt,
                        messages: [{
                            role: "user",
                            content: `Please analyze this eBay Community post for moderation:

Post: "${post_text}"
Priority: ${priority}
${learningContext}

Provide your analysis in the exact JSON format specified in your instructions.`
                        }]
                    })
                });

                if (!response.ok) {
                    const errorData = await response.text();
                    throw new Error(`Claude API failed: ${response.status} - ${errorData}`);
                }

                const result = await response.json();
                const responseText = result.content[0].text;
                let data;
                
                try {
                    // Extract JSON from response (in case there's extra text)
                    const jsonMatch = responseText.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        data = JSON.parse(jsonMatch[0]);
                    } else {
                        data = JSON.parse(responseText);
                    }
                } catch (e) {
                    throw new Error(`Invalid JSON response from Claude: ${e.message}`);
                }

                // Validate and sanitize response
                const safe = {
                    violation: VIOLATION_LEVELS.includes(data.violation) ? data.violation : "None",
                    action: AI_ACTIONS.includes(data.action) ? data.action : "NAR", 
                    sentiment: AI_SENTIMENTS.includes(data.sentiment) ? data.sentiment : "üòê",
                    rationale: String(data.rationale || ""),
                    ban_length: BAN_LENGTHS.includes(data.ban_length) ? data.ban_length : "None",
                    message_to_user: String(data.message_to_user || ""),
                    admin_note: String(data.admin_note || "Enhanced by Claude AI"),
                };

                return safe;
            };

            const saveRecordAPI = async ({ baseUrl, apiKey, record }) => {
                const res = await fetch(`${baseUrl.replace(/\/$/, "")}/records`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        ...(apiKey ? { Authorization: `Bearer ${apiKey}` } : {}),
                    },
                    body: JSON.stringify(record),
                });
                return res.ok;
            };

            const saveReportAPI = async ({ baseUrl, apiKey, report }) => {
                const res = await fetch(`${baseUrl.replace(/\/$/, "")}/reports`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        ...(apiKey ? { Authorization: `Bearer ${apiKey}` } : {}),
                    },
                    body: JSON.stringify(report),
                });
                return res.ok;
            };

            // Templates data
            const templates = {
                friendlyRemovedPost: 'Hi [USERNAME],\n \nThis is a friendly moderation notice to inform you that your recent post "[TITLE]" from [DATE_TIME] has been removed because it violated the following eBay Community Guidelines:\n \n[GUIDELINES]\n \nYou posted the following:\n \n"[QUOTE]"\n \nPlease take a moment to review the Community Guidelines to avoid making the same mistake again in the future.\n \nThank you for your cooperation in keeping the Community a welcoming, helpful, and respectful place for all users.\n \n-- The eBay Community Moderation Team',
                warningRemovedPost: 'Hi [USERNAME],\n \nThis is an official moderation warning to inform you that your recent post "[TITLE]" from [DATE_TIME] has been removed because it violated the following eBay Community Guidelines:\n \n[GUIDELINES]\n \nYou posted the following:\n \n"[QUOTE]"\n \nPlease take a moment to review the Community Guidelines to avoid making the same mistake again in the future.\n \nThank you for your cooperation in keeping the Community a welcoming, helpful, and respectful place for all users.\n \n-- The eBay Community Moderation Team',
                friendlyEditedPost: 'Hi [USERNAME],\n \nThis is a friendly moderation notice to inform you that your recent post "[TITLE]" has been edited because it violated the following eBay Community Guidelines:\n \n[GUIDELINES]\n \nYour post was edited to remove the following:\n \n"[QUOTE]"\n \nPlease take a moment to review the Community Guidelines to avoid making the same mistake again in the future.\n \nThank you for your cooperation in keeping the Community a welcoming, helpful, and respectful place for all users.\n \n-- The eBay Community Moderation Team',
                warningEditedPost: 'Hi [USERNAME],\n \nThis is an official moderation warning to inform you that your recent post "[TITLE]" has been edited because it violated the following eBay Community Guidelines:\n \n[GUIDELINES]\n \nYour post was edited to remove the following:\n \n"[QUOTE]"\n \nPlease take a moment to review the Community Guidelines to avoid making the same mistake again in the future.\n \nThank you for your cooperation in keeping the Community a welcoming, helpful, and respectful place for all users.\n \n-- The eBay Community Moderation Team',
                necroThread: 'Hi everyone,\n \nDue to the age of this thread, it has been closed to further replies. Please feel free to start a new thread if you wish to continue to discuss this topic.\n \nThank you for understanding.',
                opRequest: 'Hi everyone,\n \nThis thread has been closed at the request of the OP.\n \nThank you for understanding.',
                lockingOffTopic: 'Hi everyone,\n \nWe appreciate your participation in this discussion. However, the conversation has gone off-topic and has become a bit too heated. To help keep the community welcoming and constructive for all members, we\'re locking this thread from further replies.\n \nPlease remember to keep future discussions respectful and on-topic per our Community Guidelines.\n \nThank you for your understanding and for helping us keep the forums friendly and productive.\n \n‚Äî eBay Community Team',
                heatedDiscussion: 'Hi everyone,\n \nThis discussion has gotten a bit heated. Please remember that, while it is fine to disagree with others, discussion should always remain friendly and respectful as required by the Community Guidelines.\n \nThank you for your cooperation.',
                offTopic: 'Hi everyone,\n \nThis discussion has gotten a bit off topic. Please bring the discussion back to subject established in the original post.\n \nThank you.',
                bullying: 'Removed for not following our Community Guidelines: Please keep discussions respectful and open-minded. Differences of opinion are welcome, but conversations must remain friendly, inclusive, and considerate toward all members.',
                giftCardScam: 'Hi everyone, If you believe that you or someone you know was scammed into buying eBay Gift Cards, visit our gift card page to contact customer service and find additional information related to gift card scams. Thank you.',
                csRedirect: 'Hi [USERNAME], Thank you for submitting an inappropriate content report. However, please be advised that you have reached the eBay Community Moderation Team. Unfortunately, we are unable to assist you with your issue as we only deal with the Community.',
                gg01: 'Be respectful.',
                gg02: 'Share meaningful contributions.',
                gg03: 'Consequences and considerations: When posts veer off topic, the eBay Community team may move content at their discretion.',
                gg04: 'Reporting Inappropriate Content: The eBay Community is built for eBay users, and it is users like you who are likely to be the first to see posts that harm the community and violate Community Guidelines.',
                gg05: 'Not allowed: Publishing personal contact information of any person in any public area of eBay, including emails, phone numbers, name, street address, etc.',
                sg00: 'Refrain from posting content or taking actions that are:',
                sg01: 'adult, pornographic, violent, or mature in nature',
                sg02: 'language or threats prohibited in the Threats and offensive language policy',
                sg03: 'dishonest, unsubstantiated, or designed to mislead',
                sg04: 'duplicative or repetitive - including forum posts and replies',
                sg05: 'calling for petitions, boycotts, lawsuits, or other calls to activism',
                sg06: 'Advertising listings, products, or services in order to solicit sales',
                sg07: 'promoting off-eBay sites, groups, or forums',
                sg08: 'reposted content that has been edited or removed by eBay Community staff',
                sg09: 'about moderation warnings or consequences',
                sg10: 'Mentioning another user, listing or user ID to tarnish their reputation',
                sg11: 'encouraging others to violate the eBay User Agreement or policies',
                sg12: 'of copyrighted content without the permission of the copyright owner'
            };

            const moderationActions = [
                { id: 'spam', priority: 'P1', title: 'Dealing with Spam Messages', color: 'bg-red-50 border-red-200', steps: ['Move relevant message to Moderated Content', 'Go to Khoros Care', 'Take Friendly PM or Warning PM from Additional Templates', 'Go to user profile link', 'Click Send a message and paste the template', 'Title: Post Removed', 'Fill Username, Title, and message sections', 'Add admin note to user profile', 'Close Care report as Mod Action Taken'] },
                { id: 'ban', priority: 'P2', title: 'Banning - Spammers', color: 'bg-orange-50 border-orange-200', steps: ['Claim multiple reports of same spammer', 'Reply to duplicate reports and close all but one', 'Use member username link to go to spammer profile', 'Mark all posts as spam or move to moderated content', 'Reply to remaining AR and close as Mod Action Taken', 'Search for username', 'Add Spammer tag to author profile', 'Close conversation as Mod Action Taken'] },
                { id: 'ban-non', priority: 'P3', title: 'Banning - Non Spammers', color: 'bg-pink-50 border-pink-200', steps: ['Use Response author profile to link to member profile', 'Ban using current process', 'Document admin notes', 'Add appropriate ban tag to author profile', 'Close original conversation as Mod Action Taken'] },
                { id: 'move', priority: 'P4', title: 'Moving a Post', color: 'bg-blue-50 border-blue-200', steps: ['Go to link of the post', 'Click down arrow on message', 'Select Move Message', 'Leave everything checked', 'Move to relevant category', 'Add Moved tag in Care', 'Close Abuse Report as Mod Action Taken'] },
                { id: 'edit', priority: 'P5', title: 'Dealing with Swearing', color: 'bg-yellow-50 border-yellow-200', steps: ['Use Friendly PM: Edited Post template', 'Fill Username, Guidelines, and removed message', 'Add admin note', 'Close as Mod Action Taken', 'Add Steered and Edited tags'] },
                { id: 'bullying', priority: 'P6', title: 'Dealing with Bullying', color: 'bg-rose-50 border-rose-200', steps: ['Possible bullying should be escalated to eBay for intervene approval', 'After getting approval from eBay we can take action with the steps below', 'Edit the bullying message with [Removed by Moderator]', 'Reply to the bully with: "Removed for not following our Community Guidelines: Please keep discussions respectful and open-minded. Differences of opinion are welcome, but conversations must remain friendly, inclusive, and considerate toward all members."'] },
                { id: 'necro', priority: 'P7', title: 'Topics Older than 6 Months', color: 'bg-purple-50 border-purple-200', steps: ['Use necro thread macro from Additional Templates', 'Close the thread for new replies'] },
                { id: 'abuse', priority: 'P8', title: 'Abuse & Filter Reports', color: 'bg-teal-50 border-teal-200', steps: ['Claim and look for other reports on same user', 'If NAR, reply and close as NAR', 'If action needed, search for reported conversation', 'Claim the conversation', 'Take appropriate moderation action', 'Add tag for Edited, Moved, Moderated or Locked', 'Document action in admin notes', 'Reply to AR with actions taken', 'Close as Mod Action Taken'] },
                { id: 'closing', priority: 'P9', title: 'Closing Reports', color: 'bg-indigo-50 border-indigo-200', steps: ['If no action needed, close as NAR', 'If action needed, close as Mod Action Taken', 'Reply to AR, no need for FR', 'If PM from AR, reply but do not close', 'If duplicate, reply and close as Duplicate Report'] },
                { id: 'merging', priority: 'P10', title: 'Merging Topics', color: 'bg-cyan-50 border-cyan-200', steps: ['Topics can be moved to another forum', 'To merge, use Post ID from url', 'Navigate to post to move', 'Click down arrow, select Move Message', 'Select Merge with existing topic', 'Enter Destination Post ID', 'Configure options: Leave placeholder, Do not notify, Clear mutes', 'Click Move Post'] }
            ];

            const faqItems = [
                { id: 'spam', question: 'How do I identify spam posts?', answer: 'Spam posts typically include:\n- Repetitive content posted multiple times\n- Links to external websites for commercial purposes\n- Unsolicited advertising or promotion\n- Off-topic promotional material\n- Posts from newly created accounts with suspicious patterns' },
                { id: 'naming', question: 'What is naming and shaming?', answer: 'Naming and shaming occurs when a user publicly calls out another user by username or references their listings in a negative way. This violates community guidelines as it can lead to harassment and does not contribute to constructive discussion.' },
                { id: 'escalation', question: 'When should I escalate to a ban?', answer: 'Consider escalation to a ban when:\n- User has received multiple warnings without behavior change\n- Severe violation of community guidelines\n- Spam account with clear malicious intent\n- User continues posting after removal of content\n- Pattern of persistent policy violations' },
                { id: 'editing', question: 'When should I edit vs. remove a post?', answer: 'Edit posts when: Only a portion violates guidelines, Main content is valuable, Minor profanity can be removed\n\nRemove posts when: Entire post violates guidelines, Post is spam, Content cannot be salvaged, Multiple violations' },
                { id: 'priority', question: 'How do I determine flag priority?', answer: 'P1: Immediate threats, explicit content, severe harassment\nP2: Spam accounts, repeated violations, ban-worthy offenses\nP3: Posts in wrong category\nP4: Minor violations, profanity, posts needing editing' },
                { id: 'response', question: 'What are response times?', answer: 'P1: Within 1 hour\nP2: Within 4 hours\nP3: Within 24 hours\nP4: Within 48 hours\n\nThese are guidelines; use judgment based on severity.' }
            ];

            // Guidelines for dropdown
            const guidelineOptions = [
                { id: 'gg01', name: 'GG01: Be respectful', text: templates.gg01 },
                { id: 'gg02', name: 'GG02: Meaningful contributions', text: templates.gg02 },
                { id: 'gg03', name: 'GG03: Consequences', text: templates.gg03 },
                { id: 'gg04', name: 'GG04: Reporting Content', text: templates.gg04 },
                { id: 'gg05', name: 'GG05: Personal info', text: templates.gg05 },
                { id: 'sg00', name: 'SG00: Refrain from', text: templates.sg00 },
                { id: 'sg01', name: 'SG01: Adult content', text: templates.sg01 },
                { id: 'sg02', name: 'SG02: Threats', text: templates.sg02 },
                { id: 'sg03', name: 'SG03: Dishonest', text: templates.sg03 },
                { id: 'sg04', name: 'SG04: Duplicative', text: templates.sg04 },
                { id: 'sg05', name: 'SG05: Activism', text: templates.sg05 },
                { id: 'sg06', name: 'SG06: Advertising', text: templates.sg06 },
                { id: 'sg07', name: 'SG07: Off-eBay sites', text: templates.sg07 },
                { id: 'sg08', name: 'SG08: Reposted content', text: templates.sg08 },
                { id: 'sg09', name: 'SG09: Mod warnings', text: templates.sg09 },
                { id: 'sg10', name: 'SG10: Naming/shaming', text: templates.sg10 },
                { id: 'sg11', name: 'SG11: Policy violations', text: templates.sg11 },
                { id: 'sg12', name: 'SG12: Copyright', text: templates.sg12 }
            ];

            const selectGuideline = (templateId, guidelineId) => {
                if (guidelineId === 'other') {
                    // Clear the field and focus on the text input for custom entry
                    updateTemplateInput(templateId, 'guidelines', '');
                    // Small delay to ensure the input is cleared before focusing
                    setTimeout(() => {
                        const guidelinesInput = document.querySelector(`[data-template-id="${templateId}"][data-field="guidelines"]`);
                        if (guidelinesInput) {
                            guidelinesInput.focus();
                        }
                    }, 50);
                } else {
                    const guideline = guidelineOptions.find(g => g.id === guidelineId);
                    if (guideline) {
                        updateTemplateInput(templateId, 'guidelines', guideline.text);
                    }
                }
            };

            // Admin Notes - handle guideline selection
            const selectAdminGuideline = (noteType, guidelineId) => {
                if (guidelineId === 'other') {
                    updateAdminNoteInput(noteType, 'violation', '');
                } else {
                    const guideline = guidelineOptions.find(g => g.id === guidelineId);
                    if (guideline) {
                        // Extract clean name from "GG01: Be respectful" -> "Be respectful"
                        const cleanName = guideline.name.replace(/^[SG]+\d+:\s*/, '');
                        updateAdminNoteInput(noteType, 'violation', cleanName);
                    }
                }
            };

            const templateList = [
                { id: 'friendlyRemovedPost', name: 'Friendly PM: Removed Post', content: templates.friendlyRemovedPost, isDynamic: true, type: 'removed' },
                { id: 'warningRemovedPost', name: 'Warning PM: Removed Post', content: templates.warningRemovedPost, isDynamic: true, type: 'removed' },
                { id: 'friendlyEditedPost', name: 'Friendly PM: Edited Post', content: templates.friendlyEditedPost, isDynamic: true, type: 'edited' },
                { id: 'warningEditedPost', name: 'Warning PM: Edited Post', content: templates.warningEditedPost, isDynamic: true, type: 'edited' },
                { id: 'necroThread', name: 'Locking: Necro Thread', content: templates.necroThread },
                { id: 'opRequest', name: 'Locking: OP Request', content: templates.opRequest },
                { id: 'lockingOffTopic', name: 'Locking: Off Topic', content: templates.lockingOffTopic },
                { id: 'heatedDiscussion', name: 'Steering: Heated Discussion', content: templates.heatedDiscussion },
                { id: 'offTopic', name: 'Steering: Off Topic', content: templates.offTopic },
                { id: 'bullying', name: 'Bullying Reply', content: templates.bullying },
                { id: 'giftCardScam', name: 'Gift Card Scam Reply', content: templates.giftCardScam },
                { id: 'csRedirect', name: 'PM: CS Redirect', content: templates.csRedirect, isDynamic: true, type: 'username' }
            ];

            const guidelinesList = [
                { id: 'gg01', name: 'GG01: Be respectful', content: templates.gg01 },
                { id: 'gg02', name: 'GG02: Meaningful contributions', content: templates.gg02 },
                { id: 'gg03', name: 'GG03: Consequences', content: templates.gg03 },
                { id: 'gg04', name: 'GG04: Reporting Content', content: templates.gg04 },
                { id: 'gg05', name: 'GG05: Personal info', content: templates.gg05 },
                { id: 'sg00', name: 'SG00: Refrain from', content: templates.sg00 },
                { id: 'sg01', name: 'SG01: Adult content', content: templates.sg01 },
                { id: 'sg02', name: 'SG02: Threats', content: templates.sg02 },
                { id: 'sg03', name: 'SG03: Dishonest', content: templates.sg03 },
                { id: 'sg04', name: 'SG04: Duplicative', content: templates.sg04 },
                { id: 'sg05', name: 'SG05: Activism', content: templates.sg05 },
                { id: 'sg06', name: 'SG06: Advertising', content: templates.sg06 },
                { id: 'sg07', name: 'SG07: Off-eBay sites', content: templates.sg07 },
                { id: 'sg08', name: 'SG08: Reposted content', content: templates.sg08 },
                { id: 'sg09', name: 'SG09: Mod warnings', content: templates.sg09 },
                { id: 'sg10', name: 'SG10: Naming/shaming', content: templates.sg10 },
                { id: 'sg11', name: 'SG11: Policy violations', content: templates.sg11 },
                { id: 'sg12', name: 'SG12: Copyright', content: templates.sg12 }
            ];

            // Training data collection functions
            const recordTrainingData = (postContent, priority, userAction) => {
                const newInstance = {
                    index: trainingData.instanceCount,
                    postContent: postContent,
                    priority: priority,
                    userAction: userAction,
                    timestamp: new Date().toISOString()
                };

                setTrainingData(prev => ({
                    instanceCount: prev.instanceCount + 1,
                    trainingInstances: [...prev.trainingInstances, newInstance]
                }));
            };

            const exportTrainingData = () => {
                const dataToExport = {
                    instanceCount: trainingData.instanceCount,
                    trainingInstances: trainingData.trainingInstances,
                    exportDate: new Date().toISOString(),
                    version: "1.0"
                };

                const dataStr = JSON.stringify(dataToExport, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `AI_assistant_training_data_${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
            };

            // Admin keyboard shortcuts and console access
            useEffect(() => {
                console.log('üé® Keyboard shortcuts initialized:', keyboardShortcuts);
                
                const handleKeyDown = (event) => {
                    // Skip if user is typing in an input field (except for specific shortcuts)
                    const isInputField = event.target.tagName === 'INPUT' || 
                                       event.target.tagName === 'TEXTAREA' || 
                                       event.target.isContentEditable;
                    
                    // Debug logging - test with ANY key press
                    if (['1','2','3','4'].includes(event.key) || ['Digit1','Digit2','Digit3','Digit4'].includes(event.code)) {
                        console.log('üîç Key pressed:', {
                            key: event.key,
                            code: event.code,
                            ctrl: event.ctrlKey,
                            shift: event.shiftKey,
                            alt: event.altKey,
                            metaKey: event.metaKey,
                            isInputField: isInputField,
                            target: event.target.tagName
                        });
                        console.log('üìã Current shortcuts:', keyboardShortcuts);
                    }
                    
                    // Check custom keyboard shortcuts
                    for (const [shortcutId, shortcut] of Object.entries(keyboardShortcuts)) {
                        // Check if modifier keys match exactly (Shift is always ignored for number shortcuts)
                        const ctrlMatch = shortcut.ctrl === event.ctrlKey;
                        const altMatch = shortcut.alt === event.altKey;
                        
                        // Match by physical key code OR character (for Alt combinations that change the character)
                        const codeMap = {'1': 'Digit1', '2': 'Digit2', '3': 'Digit3', '4': 'Digit4'};
                        const keyMatch = event.key.toLowerCase() === shortcut.key.toLowerCase() || 
                                       event.code === codeMap[shortcut.key] ||
                                       event.code === 'Numpad' + shortcut.key;
                        
                        if (ctrlMatch && altMatch && keyMatch) {
                            console.log('üéØ Shortcut matched:', shortcutId, shortcut.action);
                            
                            // Only prevent default if not in input field, or if it's a custom shortcut
                            if (!isInputField || event.ctrlKey || event.altKey) {
                                event.preventDefault();
                            }
                            
                            // Execute the action
                            if (shortcut.action === 'P1 NAR') {
                                addFlag('P1', 'NAR');
                                console.log('‚úÖ P1 NAR increased via keyboard shortcut');
                            } else if (shortcut.action === 'P2 NAR') {
                                addFlag('P2', 'NAR');
                                console.log('‚úÖ P2 NAR increased via keyboard shortcut');
                            } else if (shortcut.action === 'P3 NAR') {
                                addFlag('P3', 'NAR');
                                console.log('‚úÖ P3 NAR increased via keyboard shortcut');
                            } else if (shortcut.action === 'P4 NAR') {
                                addFlag('P4', 'NAR');
                                console.log('‚úÖ P4 NAR increased via keyboard shortcut');
                            }
                            
                            // Break after first match
                            return;
                        }
                    }
                    
                    // Admin shortcuts (always available)
                    if (event.ctrlKey && event.shiftKey && event.key === 'T') {
                        event.preventDefault();
                        exportTrainingData();
                        console.log('Training data exported. Instance count:', trainingData.instanceCount);
                    }
                    if (event.ctrlKey && event.shiftKey && event.key === 'C') {
                        event.preventDefault();
                        console.log('AI Training Data:', trainingData);
                    }
                };
                
                document.addEventListener('keydown', handleKeyDown);
                window.adminTools = {
                    exportTrainingData,
                    getTrainingData: () => trainingData,
                    clearTrainingData: () => setTrainingData({ instanceCount: 0, trainingInstances: [] }),
                    getInstanceCount: () => trainingData.instanceCount
                };
                
                return () => document.removeEventListener('keydown', handleKeyDown);
            }, [trainingData, addFlag, keyboardShortcuts]);





            // Load data from localStorage on mount
            useEffect(() => {
                try {
                    const savedCounters = localStorage.getItem('ebay-mod-counters');
                    const savedTemplateInputs = localStorage.getItem('ebay-mod-template-inputs');
                    const savedAdminNotes = localStorage.getItem('ebay-mod-admin-notes');
                    const savedDarkMode = localStorage.getItem('ebay-mod-dark-mode');
                    const savedKeyboardShortcuts = localStorage.getItem('ebay-mod-keyboard-shortcuts');
                    
                    // Load AI settings
                    const savedApiBase = localStorage.getItem('ebay-mod-api-base') || "";
                    const savedApiKey = localStorage.getItem('ebay-mod-api-key') || "";
                    const savedGoLive = localStorage.getItem('ebay-mod-go-live') === "1";
                    const savedAiSaved = localStorage.getItem('ebay-mod-ai-saved');
                    const savedGroundTruth = localStorage.getItem('ebay-mod-ground-truth');
                    
                    if (savedCounters) setCounters(JSON.parse(savedCounters));
                    if (savedTemplateInputs) setTemplateInputs(JSON.parse(savedTemplateInputs));
                    if (savedAdminNotes) {
                        const parsedNotes = JSON.parse(savedAdminNotes);
                        // Ensure both edited and removed properties exist
                        setAdminNoteInputs({
                            edited: parsedNotes.edited || { link: '', removed: '', violation: '' },
                            removed: parsedNotes.removed || { link: '', violation: '' }
                        });
                    }
                    if (savedDarkMode) setDarkMode(JSON.parse(savedDarkMode));
                    if (savedKeyboardShortcuts) setKeyboardShortcuts(JSON.parse(savedKeyboardShortcuts));
                    
                    setApiBase(savedApiBase);
                    setApiKey(savedApiKey);
                    setGoLive(savedGoLive);
                    if (savedAiSaved) setAiSaved(JSON.parse(savedAiSaved));
                    if (savedGroundTruth) setGroundTruthNotes(JSON.parse(savedGroundTruth));
                } catch (error) {
                    console.error('Error loading saved data:', error);
                }
            }, []);

            // Save counters to localStorage
            useEffect(() => {
                try {
                    localStorage.setItem('ebay-mod-counters', JSON.stringify(counters));
                } catch (error) {
                    console.error('Error saving counters:', error);
                }
            }, [counters]);

            // Save template inputs to localStorage
            useEffect(() => {
                try {
                    localStorage.setItem('ebay-mod-template-inputs', JSON.stringify(templateInputs));
                } catch (error) {
                    console.error('Error saving template inputs:', error);
                }
            }, [templateInputs]);

            // Save admin notes to localStorage
            useEffect(() => {
                try {
                    localStorage.setItem('ebay-mod-admin-notes', JSON.stringify(adminNoteInputs));
                } catch (error) {
                    console.error('Error saving admin notes:', error);
                }
            }, [adminNoteInputs]);

            // Save dark mode preference to localStorage
            useEffect(() => {
                try {
                    localStorage.setItem('ebay-mod-dark-mode', JSON.stringify(darkMode));
                } catch (error) {
                    console.error('Error saving dark mode:', error);
                }
            }, [darkMode]);
            
            // Save keyboard shortcuts to localStorage
            useEffect(() => {
                try {
                    localStorage.setItem('ebay-mod-keyboard-shortcuts', JSON.stringify(keyboardShortcuts));
                } catch (error) {
                    console.error('Error saving keyboard shortcuts:', error);
                }
            }, [keyboardShortcuts]);

            // Save training data to localStorage
            useEffect(() => {
                try {
                    localStorage.setItem('ebay-mod-training-data', JSON.stringify(trainingData));
                } catch (error) {
                    console.error('Error saving training data:', error);
                }
            }, [trainingData]);

            // Save AI settings to localStorage
            useEffect(() => {
                try {
                    localStorage.setItem('ebay-mod-api-base', apiBase || "");
                    localStorage.setItem('ebay-mod-api-key', apiKey || "");
                    localStorage.setItem('ebay-mod-go-live', goLive ? "1" : "0");
                } catch (error) {
                    console.error('Error saving AI settings:', error);
                }
            }, [apiBase, apiKey, goLive]);

            // Save AI saved items to localStorage
            useEffect(() => {
                try {
                    localStorage.setItem('ebay-mod-ai-saved', JSON.stringify(aiSaved));
                } catch (error) {
                    console.error('Error saving AI saved items:', error);
                }
            }, [aiSaved]);

            // Save ground truth notes to localStorage
            useEffect(() => {
                try {
                    localStorage.setItem('ebay-mod-ground-truth', JSON.stringify(groundTruthNotes));
                } catch (error) {
                    console.error('Error saving ground truth notes:', error);
                }
            }, [groundTruthNotes]);

            // Learning system - analyze patterns from historical corrections
            const analyzeLearningPatterns = () => {
                if (aiSaved.length < 3) return null;
                
                const patterns = {
                    overrideRate: 0,
                    commonOverrides: {},
                    violationAccuracy: {},
                    priorityBiases: {},
                    recentTrend: 'stable'
                };
                
                // Calculate overall override rate
                const overrides = aiSaved.filter(r => r.ai && r.ai.action !== r.final_action).length;
                patterns.overrideRate = Math.round((overrides / aiSaved.length) * 100);
                
                // Analyze common override patterns
                aiSaved.forEach(record => {
                    if (record.ai && record.ai.action !== record.final_action) {
                        const pattern = `${record.ai.action}‚Üí${record.final_action}`;
                        patterns.commonOverrides[pattern] = (patterns.commonOverrides[pattern] || 0) + 1;
                    }
                    
                    // Track violation detection accuracy  
                    if (record.ai) {
                        const hasViolation = record.final_action !== "NAR";
                        const aiDetectedViolation = record.ai.violation !== "None";
                        const key = hasViolation ? "violations_detected" : "clean_posts_detected";
                        patterns.violationAccuracy[key] = (patterns.violationAccuracy[key] || 0) + (hasViolation === aiDetectedViolation ? 1 : 0);
                    }
                });
                
                return patterns;
            };

            // Enhanced local AI that learns from user corrections (with global fallback)
            const enhancedLocalSuggest = async (post, priority) => {
                let suggestion = localSuggest(post, priority);
                
                // Try to get global learning patterns first
                let patterns = null;
                try {
                    const response = await fetch('/api/learning-patterns');
                    if (response.ok) {
                        const globalPatterns = await response.json();
                        patterns = {
                            overrideRate: 100 - globalPatterns.globalStats.accuracy,
                            commonOverrides: globalPatterns.overridePatterns,
                            violationAccuracy: globalPatterns.violationAccuracy,
                            isGlobal: true
                        };
                        console.log(`üåê Using global learning patterns (${globalPatterns.globalStats.totalAnalyses} team interactions)`);
                    }
                } catch (error) {
                    console.warn('Could not fetch global patterns, using local:', error);
                    patterns = analyzeLearningPatterns();
                    if (patterns) patterns.isGlobal = false;
                }
                
                if (patterns && (patterns.isGlobal || aiSaved.length >= 5)) {
                    // Adjust based on learning patterns
                    const overrideRate = patterns.overrideRate;
                    
                    // If we're consistently over-suggesting certain actions, tone them down
                    if (patterns.commonOverrides["Ban‚ÜíEdit"] > 2) {
                        if (suggestion.action === "Ban" && suggestion.violation !== "Major") {
                            suggestion.action = "Edit";
                            suggestion.ban_length = "None";
                            suggestion.rationale += " [Learned adjustment: Previously over-suggested bans for this violation level]";
                        }
                    }
                    
                    if (patterns.commonOverrides["Edit‚ÜíSteer"] > 2) {
                        if (suggestion.action === "Edit" && suggestion.violation === "Minor") {
                            suggestion.action = "Steer";
                            suggestion.rationale += " [Learned adjustment: User prefers steering for minor violations]";
                        }
                    }
                    
                    if (patterns.commonOverrides["NAR‚ÜíSteer"] > 1 && priority === "P1") {
                        if (suggestion.action === "NAR") {
                            suggestion.action = "Steer";
                            suggestion.violation = "Minor";
                            suggestion.rationale = "P1 flagged content requires action even when no clear violation detected. [Learned from user feedback]";
                        }
                    }
                    
                    // Note: Learning features disabled for production
                }
                
                return suggestion;
            };

            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (openDropdown && dropdownRefs.current[openDropdown]) {
                        if (!dropdownRefs.current[openDropdown].contains(event.target)) {
                            setOpenDropdown(null);
                        }
                    }
                };
                document.addEventListener('mousedown', handleClickOutside);
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, [openDropdown]);

            const copyToClipboard = async (text, id) => {
                try {
                    await navigator.clipboard.writeText(text);
                    setCopiedId(id);
                    setTimeout(() => setCopiedId(null), 2000);
                } catch (err) {
                    console.error('Failed to copy');
                }
            };
            
            const copyToAdminNotes = (templateId) => {
                const inputs = templateInputs[templateId] || {};
                const removed = inputs.quote || '';
                const violation = inputs.guidelines || '';
                
                // Determine if this is an edited or removed post template
                const isRemovedPost = templateId.includes('Removed');
                
                if (isRemovedPost) {
                    // Update removed post admin notes (no "removed portion" field)
                    setAdminNoteInputs(prev => ({
                        ...prev,
                        removed: {
                            link: '',
                            violation: violation
                        }
                    }));
                } else {
                    // Update edited post admin notes (has "removed portion" field)
                    setAdminNoteInputs(prev => ({
                        ...prev,
                        edited: {
                            link: '',
                            removed: removed,
                            violation: violation
                        }
                    }));
                }
                
                // Show a brief confirmation
                setCopiedId(templateId + '-admin');
                setTimeout(() => setCopiedId(null), 2000);
                
                console.log('‚úÖ Copied to Admin Notes:', { type: isRemovedPost ? 'removed' : 'edited', removed: removed, violation: violation });
            };

            const updateTemplateInput = (templateId, field, value) => {
                setTemplateInputs(prev => ({
                        ...prev,
                    [templateId]: { ...prev[templateId], [field]: value }
                }));
            };

            const clearTemplateInputs = (templateId) => {
                const defaults = {
                    friendlyRemovedPost: { username: '', title: '', datetime: '', guidelines: '', quote: '' },
                    warningRemovedPost: { username: '', title: '', datetime: '', guidelines: '', quote: '' },
                    friendlyEditedPost: { username: '', title: '', guidelines: '', quote: '' },
                    warningEditedPost: { username: '', title: '', guidelines: '', quote: '' },
                    csRedirect: { username: '' },
                    banCombined: { banPeriod: '1 Day', reasoning: '', username: '', email: '', ip: '', spamUrl: '', startDate: '' }
                };
                if (defaults[templateId]) {
                    setTemplateInputs(prev => ({ ...prev, [templateId]: defaults[templateId] }));
                }
            };

            const getPopulatedTemplate = (templateId, baseTemplate) => {
                const inputs = templateInputs[templateId] || {};
                let populated = baseTemplate;
                
                if (templateId.includes('Removed')) {
                    populated = populated
                        .replace('[USERNAME]', inputs.username || '[USERNAME]')
                        .replace('[TITLE]', inputs.title || '[TITLE]')
                        .replace('[DATE_TIME]', inputs.datetime || '[DATE_TIME]')
                        .replace('[GUIDELINES]', inputs.guidelines || '[GUIDELINES]')
                        .replace('[QUOTE]', inputs.quote || '[QUOTE]');
                } else if (templateId.includes('Edited')) {
                    populated = populated
                        .replace('[USERNAME]', inputs.username || '[USERNAME]')
                        .replace('[TITLE]', inputs.title || '[TITLE]')
                        .replace('[GUIDELINES]', inputs.guidelines || '[GUIDELINES]')
                        .replace('[QUOTE]', inputs.quote || '[QUOTE]');
                } else if (templateId === 'csRedirect') {
                    populated = populated.replace('[USERNAME]', inputs.username || '[USERNAME]');
                } else if (templateId === 'banCombined') {
                    const banLength = inputs.banPeriod === '1 Day' ? '1 day' : 
                                    inputs.banPeriod === '3 Days' ? '3 days' :
                                    inputs.banPeriod === '7 Days' ? '7 days' :
                                    inputs.banPeriod === '30 Days' ? '30 days' : 'indefinite';
                    populated = 'Internal Reason\n\n' + inputs.banPeriod + ' Login Restriction\n\nReasoning: ' + (inputs.reasoning || '[Reasoning]') + '\nUsername: ' + (inputs.username || '[Username]') + '\nEmail: ' + (inputs.email || '[Email]') + '\nIP: ' + (inputs.ip || '[IP]') + '\nURL: ' + (inputs.spamUrl || '[URL]') + '\nStart Date: ' + (inputs.startDate || '[DATE]') + '\nBan Length: ' + banLength + '\n\n---\n\nPublic Reason\n\nViolating the rules and policies of the eBay Community with actions such as ' + (inputs.reasoning || '[Reasoning]') + '. Your ban is effective from ' + (inputs.startDate || '[DATE]') + ' and will last ' + banLength + '.';
                }
                return populated;
            };

            const updateAdminNoteInput = (noteId, field, value) => {
                setAdminNoteInputs(prev => {
                    // Ensure the noteId object exists before updating
                    const currentNote = prev[noteId] || (noteId === 'edited' 
                        ? { link: '', removed: '', violation: '' }
                        : { link: '', violation: '' });
                    
                    return {
                        ...prev,
                        [noteId]: { ...currentNote, [field]: value }
                    };
                });
            };

            const clearAdminNoteInputs = (noteId) => {
                if (noteId === 'edited') {
                    setAdminNoteInputs(prev => ({
                        ...prev,
                        edited: { link: '', removed: '', violation: '' }
                    }));
                } else if (noteId === 'removed') {
                    setAdminNoteInputs(prev => ({
                        ...prev,
                        removed: { link: '', violation: '' }
                    }));
                }
            };

            const getPopulatedAdminNote = (noteId) => {
                const inputs = adminNoteInputs[noteId] || {};
                if (noteId === 'edited') {
                    return '<a href="' + (inputs.link || '[link]') + '">Edited Post</a> to remove "' + (inputs.removed || '[removed portion]') + '".<br>Sent user a friendly PM for: ' + (inputs.violation || '[violation]');
                } else if (noteId === 'removed') {
                    return '<a href="' + (inputs.link || '[link]') + '">Removed Post</a><br>Sent user a friendly PM for: ' + (inputs.violation || '[violation]');
                }
                return '';
            };

            const addFlag = (priority, actionType) => {
                setCounters(prev => ({
                    ...prev,
                    [priority]: { ...prev[priority], [actionType]: prev[priority][actionType] + 1 }
                }));
            };

            const removeFlag = (priority, actionType) => {
                setCounters(prev => ({
                    ...prev,
                    [priority]: { ...prev[priority], [actionType]: Math.max(0, prev[priority][actionType] - 1) }
                }));
            };

            const handleManualFlagChange = (priority, actionType, value) => {
                const parsedValue = parseInt(value, 10);
                const normalizedValue = Number.isNaN(parsedValue) || parsedValue < 0 ? 0 : parsedValue;

                setCounters(prev => ({
                    ...prev,
                    [priority]: {
                        ...prev[priority],
                        [actionType]: normalizedValue
                    }
                }));
            };

            const resetCounters = () => {
                const emptyCounters = {
                    P1: { NAR: 0, Edit: 0, Steer: 0, Remove: 0, Ban: 0, Locked: 0, Moved: 0 },
                    P2: { NAR: 0, Edit: 0, Steer: 0, Remove: 0, Ban: 0, Locked: 0, Moved: 0 },
                    P3: { NAR: 0, Edit: 0, Steer: 0, Remove: 0, Ban: 0, Locked: 0, Moved: 0 },
                    P4: { NAR: 0, Edit: 0, Steer: 0, Remove: 0, Ban: 0, Locked: 0, Moved: 0 }
                };
                setCounters(emptyCounters);
                
                // Clear all template textboxes
                setTemplateInputs({
                    friendlyRemovedPost: { url: '', username: '', title: '', datetime: '', guidelines: '', quote: '' },
                    warningRemovedPost: { url: '', username: '', title: '', datetime: '', guidelines: '', quote: '' },
                    friendlyEditedPost: { url: '', username: '', title: '', guidelines: '', quote: '' },
                    warningEditedPost: { url: '', username: '', title: '', guidelines: '', quote: '' },
                    csRedirect: { url: '', username: '' },
                    banCombined: { url: '', banPeriod: '1 Day', reasoning: '', username: '', email: '', ip: '', spamUrl: '', startDate: '' }
                });
                
                // Clear admin note inputs
                setAdminNoteInputs({
                    edited: { link: '', removed: '', violation: '' },
                    removed: { link: '', violation: '' }
                });
                
                setShowResetConfirm(false);
            };

            // AI event handlers
            const runAI = async () => {
                // Input validation
                if (!aiPost.trim()) {
                    setErrorSuggest("Please enter post content to analyze");
                    return;
                }
                
                if (aiPost.length > 10000) {
                    setErrorSuggest("Post content too long (max 10,000 characters)");
                    return;
                }
                
                setBusySuggest(true); 
                setErrorSuggest("");
                
                try {
                    let suggestion;
                    if (goLive && apiBase) {
                        // Validate API configuration
                        if (!apiBase.startsWith('http')) {
                            throw new Error("Invalid API URL - must start with http:// or https://");
                        }
                        
                        suggestion = await callModerationAPI({ baseUrl: apiBase, apiKey, post_text: aiPost, priority: aiPriority });
                        setLiveStatus("ready");
                        console.log("‚úÖ AI API Success:", suggestion);
                    } else {
                        suggestion = await enhancedLocalSuggest(aiPost, aiPriority);
                        setLiveStatus("offline");
                        console.log("üîß Enhanced Local AI Analysis:", suggestion);
                    }
                    
                    // Validate suggestion response
                    if (!suggestion || typeof suggestion !== 'object') {
                        throw new Error("Invalid AI response format");
                    }
                    
                    setAiSuggestion(suggestion);
                } catch (e) {
                    console.error("‚ùå AI Error:", e);
                    // Fallback to enhanced learning local analysis with error context
                    const fallback = await enhancedLocalSuggest(aiPost, aiPriority);
                    fallback.admin_note = `API Error (${e.message}) - Using enhanced local fallback with learning`;
                    setAiSuggestion(fallback);
                    setLiveStatus("error");
                    setErrorSuggest(`API Error: ${e.message}`);
                } finally {
                    setBusySuggest(false);
                }
            };

            const closeAI = async () => {
                if (!aiSuggestion) {
                    setErrorSuggest("No AI suggestion to complete");
                    return;
                }
                
                if (!aiFinalAction) {
                    setErrorSuggest("Please select the action you actually took");
                    return;
                }
                
                try {
                    // Map AI actions to existing counter actions
                    // AI actions now match EOS report actions exactly - direct mapping
                    const counterAction = aiFinalAction;
                    
                    // Validate action is in our tracking system
                    if (!modActionTypes.includes(aiFinalAction)) {
                        console.warn(`‚ö†Ô∏è Unknown action "${aiFinalAction}" - not in EOS tracking system`);
                    }
                    
                    // Update existing counter system (P1-P4 only, since existing system doesn't have P5)
                    const validPriority = ["P1", "P2", "P3", "P4"].includes(aiPriority) ? aiPriority : "P4";
                    
                    if (counters[validPriority] && counters[validPriority][counterAction] !== undefined) {
                        addFlag(validPriority, counterAction);
                        console.log(`‚úÖ AI Completion: Updated counter ${validPriority} ${counterAction} (+1)`);
                    } else {
                        console.warn(`‚ö†Ô∏è Could not map AI action "${aiFinalAction}" to counter action. Available actions:`, Object.keys(counters[validPriority] || {}));
                    }
                    
                    // Calculate accuracy metrics
                    const isCorrectAction = aiSuggestion.action === aiFinalAction;
                    const isCorrectViolation = aiSuggestion.violation !== "None";
                    
                    // Record global learning interaction for cross-user intelligence
                    await recordGlobalLearningInteraction(
                        aiPost,
                        aiPriority,
                        aiSuggestion,
                        aiFinalAction,
                        isCorrectAction
                    );
                    
                    // Save AI interaction for learning
                    const rec = { 
                        id: uid(), 
                        source: "AI", 
                        post_text: aiPost.substring(0, 200) + (aiPost.length > 200 ? "..." : ""), // Truncate for storage
                        priority: aiPriority, 
                        ai: aiSuggestion, 
                        final_action: aiFinalAction, 
                        counter_updated: `${validPriority}-${counterAction}`,
                        accuracy: {
                            action_match: isCorrectAction,
                            violation_detected: isCorrectViolation
                        },
                        timestamp: new Date().toISOString()
                    };
                    setAiSaved((s) => [rec, ...s]);
                    
                    // Track learning when user overrides AI suggestion
                    if (!isCorrectAction) {
                        const learningNote = `Override: AI suggested ${aiSuggestion.action} ‚Üí User chose ${aiFinalAction} | Post: "${aiPost.substring(0, 50)}..." | Violation: ${aiSuggestion.violation} | Priority: ${aiPriority}`;
                        setGroundTruthNotes((g) => [learningNote, ...g.slice(0, 49)]); // Keep max 50 notes
                    }
                    
                    // Save to API if live
                    if (goLive && apiBase) { 
                        try { 
                            await saveRecordAPI({ baseUrl: apiBase, apiKey, record: rec }); 
                            console.log("üíæ Saved to API successfully");
                        } catch (e) {
                            console.warn("‚ö†Ô∏è Failed to save to API:", e.message);
                        }
                    }
                    
                    // Show success feedback
                    console.log(`üéØ AI Analysis Complete: ${isCorrectAction ? 'Matched' : 'Override'} | Counter: ${validPriority}+${counterAction}`);
                    
                    // Reset inputs
                    setAiPost(""); 
                    setAiPriority("P3"); 
                    setAiSuggestion(null); 
                    setAiFinalAction("");
                    setAiPostDateTime("");
                    setErrorSuggest("");
                    
                } catch (error) {
                    console.error("‚ùå Error completing AI analysis:", error);
                    setErrorSuggest(`Error: ${error.message}`);
                }
            };

            const removeAiRecord = (id) => setAiSaved((s) => s.filter((r) => r.id !== id));


            // Global learning functions
            const recordGlobalLearningInteraction = async (postContent, priority, aiAnalysis, userAction, wasCorrect) => {
                try {
                    const sessionId = localStorage.getItem('ebay-mod-session-id') || 
                        `user_${Date.now()}_${Math.random().toString(36).slice(2)}`;
                    
                    if (!localStorage.getItem('ebay-mod-session-id')) {
                        localStorage.setItem('ebay-mod-session-id', sessionId);
                    }

                    const response = await fetch('/api/learning-patterns/interaction', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            postContent,
                            priority,
                            aiViolation: aiAnalysis?.violation || 'Unknown',
                            aiAction: aiAnalysis?.action || 'Unknown',
                            userAction,
                            wasCorrect,
                            sessionId
                        })
                    });

                    if (response.ok) {
                        const result = await response.json();
                        console.log(`‚úÖ Global learning updated: Team accuracy now ${result.globalAccuracy}% (${result.totalAnalyses} total)`);
                    } else {
                        console.warn('Failed to record global learning interaction');
                    }
                } catch (error) {
                    console.warn('Could not record global learning interaction:', error);
                    // Continue with local learning as fallback
                }
            };

            const configureApi = () => {
                const key = prompt("Claude API Key (from Anthropic Console)", apiKey || "sk-ant-api03-...");
                if (key !== null) {
                    setApiKey(key);
                    alert("Claude API key configured! ‚ú®\n\nClick 'Go Live' to start using Claude AI for moderation assistance.");
                }
            };

            const testCases = [
                // Major violations
                { name: "Violence threat ‚Üí Major/Ban", post: "I'll beat you up if you outbid me again.", priority: "P1", expect: { violation: "Major", action: "Ban" } },
                { name: "Severe profanity ‚Üí Major/Ban", post: "You're such an asshole for bidding against me.", priority: "P1", expect: { violation: "Major", action: "Ban" } },
                { name: "Fraud accusation ‚Üí Major/Remove", post: "This eBay seller is a scam artist trying to cheat buyers.", priority: "P1", expect: { violation: "Major", action: "Remove" } },
                
                // Moderate violations
                { name: "Phone number sharing ‚Üí Moderate/Edit", post: "Please call me at 215-858-8440 if interested.", priority: "P2", expect: { violation: "Moderate", action: "Edit" } },
                { name: "Email address sharing ‚Üí Moderate/Edit", post: "Contact me at john@gmail.com for more info.", priority: "P3", expect: { violation: "Moderate", action: "Edit" } },
                { name: "Mod hostility ‚Üí Moderate/Edit", post: "The mods suck and eBay is corrupt and useless.", priority: "P2", expect: { violation: "Moderate", action: "Edit" } },
                { name: "Personal attack ‚Üí Moderate/Edit", post: "You're so stupid and ignorant about this topic.", priority: "P3", expect: { violation: "Moderate", action: "Edit" } },
                
                // Context-aware personal info (should be NAR)
                { name: "eBay phone question ‚Üí None/NAR", post: "What's eBay's phone number for customer service?", priority: "P3", expect: { violation: "None", action: "NAR" } },
                { name: "eBay no phone ‚Üí None/NAR", post: "eBay doesn't have a phone number, you have to use chat.", priority: "P3", expect: { violation: "None", action: "NAR" } },
                { name: "Email delivery issue ‚Üí None/NAR", post: "My email isn't getting eBay notifications anymore.", priority: "P3", expect: { violation: "None", action: "NAR" } },
                { name: "Address delivery issue ‚Üí None/NAR", post: "Package didn't arrive at my address, what should I do?", priority: "P3", expect: { violation: "None", action: "NAR" } },
                { name: "Email concept discussion ‚Üí None/NAR", post: "The email address format requirements are confusing.", priority: "P4", expect: { violation: "None", action: "NAR" } },
                
                // Minor violations
                { name: "Advertising ‚Üí Minor/Steer", post: "Check out my store at bestdeals.com for great prices!", priority: "P3", expect: { violation: "Minor", action: "Steer" } },
                { name: "Off-topic ‚Üí Minor/Steer", post: "This is off-topic and a waste of time to discuss.", priority: "P4", expect: { violation: "Minor", action: "Steer" } },
                { name: "Heated discussion ‚Üí Minor/Lock", post: "Everyone is arguing and this is getting heated and personal.", priority: "P3", expect: { violation: "Minor", action: "Lock" } },
                
                // Positive cases
                { name: "Help request ‚Üí None/NAR", post: "Can someone please help me understand how eBay's return policy works?", priority: "P4", expect: { violation: "None", action: "NAR" } },
                { name: "Thank you post ‚Üí None/NAR", post: "Thanks so much for the helpful advice, I really appreciate it!", priority: "P5", expect: { violation: "None", action: "NAR" } },
                
                // Edge cases
                { name: "Empty post ‚Üí Minor/Remove", post: "", priority: "P3", expect: { violation: "Minor", action: "Remove" } },
                { name: "Very short ‚Üí Minor/Steer", post: "ok", priority: "P4", expect: { violation: "Minor", action: "Steer" } },
                { name: "P1 clean post ‚Üí Minor (escalated)", post: "This is a normal question about shipping.", priority: "P1", expect: { violation: "Minor", action: "NAR" } }
            ];
            
            const runDevTests = async () => {
                setIsRunningTests(true);
                const results = [];
                try {
                    for (const tc of testCases) {
                        const got = await enhancedLocalSuggest(tc.post, tc.priority); 
                        const pass = got.violation === tc.expect.violation && got.action === tc.expect.action; 
                        results.push({ name: tc.name, pass, got: { v: got.violation, a: got.action }, expect: tc.expect });
                    }
                    setTestResults(results);
                    console.log('‚úÖ Dev Tests completed:', results);
                } catch (error) {
                    console.error('‚ùå Dev Tests failed:', error);
                    setTestResults([]);
                } finally {
                    setIsRunningTests(false);
                }
            };

            const getTotalForPriority = (priority) => {
                return Object.values(counters[priority] || {}).reduce((sum, count) => sum + count, 0);
            };

            const getTotalFlags = () => {
                return Object.keys(counters).reduce((sum, priority) => sum + getTotalForPriority(priority), 0);
            };

            const generateEOSReport = () => {
                const totalFlags = getTotalFlags();
                let report = `**Posts QAed: ${totalFlags}**\n`;
                ['P1', 'P2', 'P3', 'P4'].forEach(priority => {
                    const total = getTotalForPriority(priority);
                    if (total > 0) {
                        report += `* ${priority} reports: ${total}\n`;
                        modActionTypes.forEach(actionType => {
                            const count = counters[priority][actionType];
                            if (count > 0) {
                                report += `   * ${count} ${actionType}\n`;
                            }
                        });
                    }
                });
                return report;
            };

            const bgClass = darkMode ? 'min-h-screen bg-slate-900 p-6' : 'min-h-screen bg-slate-50 p-6';
            const cardBg = darkMode ? 'bg-slate-800' : 'bg-white';
            const textPrimary = darkMode ? 'text-slate-100' : 'text-slate-800';
            const textSecondary = darkMode ? 'text-slate-400' : 'text-slate-600';
            const borderColor = darkMode ? 'border-slate-700' : 'border-slate-200';

            return (
                <div className={bgClass}>
                    <div className="max-w-5xl mx-auto">
                        {/* Header */}
                        <div className={`${cardBg} rounded-lg shadow-lg p-6 mb-6 ${borderColor} border`}>
                            <div className="flex items-center gap-3 mb-4">
                                <div className="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center">
                                    <svg className="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                </div>
                                <div className="flex-1">
                                    <h1 className={`text-3xl font-bold ${textPrimary}`}>eBay Community Moderation</h1>
                                    <p className={textSecondary}>Quick reference guide with ready-to-use templates</p>
                                </div>
                                <div className="flex items-center gap-3">
                                    <a 
                                        href="https://ebay.response.lithium.com/khoros/login" 
                                        target="_blank" 
                                        rel="noopener noreferrer"
                                        className="px-4 py-2 rounded-lg font-semibold text-sm bg-blue-600 hover:bg-blue-700 text-white transition-colors"
                                    >
                                        Login to Care
                                    </a>
                                    <button 
                                        onClick={() => setDarkMode(!darkMode)} 
                                        className={`px-4 py-2 rounded-lg font-semibold text-sm flex items-center gap-2 ${darkMode ? 'bg-slate-700 hover:bg-slate-600 text-slate-200' : 'bg-slate-200 hover:bg-slate-300 text-slate-700'}`}
                                    >
                                        {darkMode ? <><Sun className="w-5 h-5" /><span>Light</span></> : <><Moon className="w-5 h-5" /><span>Dark</span></>}
                                    </button>
                                </div>
                            </div>

                            {/* Counter Section */}
                            <div className={`${darkMode ? 'bg-slate-700' : 'bg-slate-50'} rounded-lg p-4 border-2 ${borderColor}`}>
                                <div className="flex items-center justify-between mb-3">
                                    <h3 className={`font-semibold ${textPrimary}`}>Today's Flags Resolved</h3>
                                    <button
                                        onClick={() => setShowResetConfirm(true)}
                                        className={`text-xs px-3 py-1 rounded ${darkMode ? 'bg-slate-600 hover:bg-slate-500 text-slate-200' : 'bg-slate-200 hover:bg-slate-300 text-slate-700'}`}
                                    >
                                        Reset All
                                    </button>
                                </div>
                                <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-3">
                                    {['P1', 'P2', 'P3', 'P4'].map((priority) => {
                                        const total = getTotalForPriority(priority);
                                        const isOpen = openDropdown === priority;
                                        const narCount = counters[priority]?.NAR || 0;
                                        return (
                                            <div key={priority} className={`${cardBg} rounded-lg p-2 sm:p-3 border-2 ${borderColor} relative min-w-0`} ref={(el) => { if (el) dropdownRefs.current[priority] = el; }}>
                                                <div className={`text-xs font-semibold mb-1 text-center ${textSecondary}`}>{priority}</div>
                                                <div className="text-2xl sm:text-3xl font-bold text-blue-600 mb-2 text-center">{total}</div>
                                                <button onClick={() => setOpenDropdown(isOpen ? null : priority)} className="w-full py-1.5 sm:py-2 bg-blue-100 hover:bg-blue-200 rounded flex items-center justify-center gap-1 mb-2">
                                                    {isOpen ? (<><span className="text-xs font-semibold text-blue-700">Close</span><ChevronUp className="w-3 h-3 text-blue-700" /></>) : (<Plus className="w-4 h-4 text-blue-700" />)}
                                                </button>
                                                <div className="w-full flex flex-col gap-1">
                                                    <span className={`text-xs font-medium text-center ${darkMode ? 'text-gray-300' : 'text-slate-600'}`}>NAR</span>
                                                    <div className="flex items-center gap-2">
                                                        <button
                                                            onClick={() => removeFlag(priority, 'NAR')}
                                                            className="w-6 h-6 flex items-center justify-center rounded flex-shrink-0 transition-colors"
                                                            style={{ backgroundColor: 'rgb(254, 226, 226)' }}
                                                        >
                                                            <Minus className="w-3 h-3 text-red-600" />
                                                        </button>
                                                        <input
                                                            type="number"
                                                            min="0"
                                                            value={narCount}
                                                            onChange={(e) => handleManualFlagChange(priority, 'NAR', e.target.value)}
                                                            className={`flex-1 min-w-0 px-2 py-1 text-sm text-center rounded border ${darkMode ? 'bg-slate-800 border-slate-700 text-white' : 'bg-white border-slate-300 text-slate-800'}`}
                                                        />
                                                        <button
                                                            onClick={() => addFlag(priority, 'NAR')}
                                                            className="w-6 h-6 flex items-center justify-center rounded flex-shrink-0 transition-colors"
                                                            style={{ backgroundColor: 'rgb(220, 252, 231)' }}
                                                        >
                                                            <Plus className="w-3 h-3 text-green-600" />
                                                        </button>
                                                    </div>
                                                </div>
                                                {isOpen && (
                                                    <div className={`absolute top-full left-1/2 -translate-x-1/2 mt-2 ${cardBg} border-2 ${borderColor} rounded-lg shadow-lg z-10 p-2 w-48`}>
                                                        <div className="space-y-2">
                                                            {dropdownActionTypes.map(actionType => {
                                                                const count = counters[priority][actionType] || 0;
                                                                return (
                                                                    <div key={actionType} className={`${darkMode ? 'bg-slate-700' : 'bg-slate-50'} p-2 rounded`}>
                                                                        <div className={`text-xs font-medium text-center mb-1 ${textSecondary}`}>{actionType}</div>
                                                                        <div className="flex items-center gap-2">
                                                                            <button onClick={() => removeFlag(priority, actionType)} className="w-7 h-7 flex items-center justify-center bg-red-100 hover:bg-red-200 rounded flex-shrink-0"><Minus className="w-4 h-4 text-red-600" /></button>
                                                                            <input
                                                                                type="number"
                                                                                min="0"
                                                                                value={count}
                                                                                onChange={(e) => handleManualFlagChange(priority, actionType, e.target.value)}
                                                                                className={`flex-1 min-w-0 px-2 py-1 text-sm text-center rounded border ${darkMode ? 'bg-slate-800 border-slate-600 text-white' : 'bg-white border-slate-300 text-slate-800'}`}
                                                                            />
                                                                            <button onClick={() => addFlag(priority, actionType)} className="w-7 h-7 flex items-center justify-center bg-green-100 hover:bg-green-200 rounded flex-shrink-0"><Plus className="w-4 h-4 text-green-600" /></button>
                                                                        </div>
                                                                    </div>
                                                                );
                                                            })}
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })}
                                    <div className="bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg p-2 sm:p-3 border-2 border-blue-400 text-center min-w-0">
                                        <div className="text-xs font-semibold text-blue-100 mb-1">TOTAL</div>
                                        <div className="text-2xl sm:text-3xl font-bold text-white mb-2 sm:mb-3">{getTotalFlags()}</div>
                                        <button onClick={() => setShowEOSReport(true)} className="w-full py-1.5 sm:py-2 bg-white hover:bg-blue-50 text-blue-600 rounded font-semibold text-sm">EOS</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* AI Moderation Assistant Section - TOP POSITION */}
                        <div className={`${cardBg} rounded-lg shadow p-4 mb-6 border ${borderColor}`}>
                            <button onClick={() => setShowAI(!showAI)} className="w-full flex items-center justify-between mb-3">
                                <div className="flex items-center gap-2">
                                    <Sparkles className={`w-5 h-5 ${darkMode ? 'text-blue-400' : 'text-blue-600'}`} />
                                    <h3 className={`font-semibold ${textPrimary}`}>AI Moderation Assistant</h3>
                                </div>
                                <div className="flex items-center gap-2">
                                    <span className={`text-sm ${textSecondary}`}>{showAI ? 'Hide' : 'Show'}</span>
                                    {showAI ? <ChevronUp className={`w-5 h-5 ${textSecondary}`} /> : <ChevronDown className={`w-5 h-5 ${textSecondary}`} />}
                                </div>
                            </button>
                            
                            {showAI && (
                                <div className="space-y-4">
                                    {/* Admin note: GO Live and API Settings buttons removed for production */}

                                    {/* Main AI Interface */}
                                    <div className={`border rounded-lg overflow-hidden ${borderColor}`}>
                                        <div className={`${darkMode ? 'bg-blue-900' : 'bg-blue-50'} px-3 py-2 border-b ${borderColor}`}>
                                            <h4 className={`text-sm font-semibold ${darkMode ? 'text-blue-100' : 'text-slate-800'}`}>Analyze Post for Moderation</h4>
                                        </div>
                                        <div className={`p-3 space-y-3 ${darkMode ? 'bg-slate-900' : 'bg-white'}`}>
                                            <div>
                                                <label className={`block text-sm font-medium mb-1 ${textPrimary}`}>Post Content</label>
                                                <textarea
                                                    value={aiPost}
                                                    onChange={(e) => setAiPost(e.target.value)}
                                                    placeholder="Paste the post content here for AI analysis..."
                                                    rows={4}
                                                    className={`w-full px-3 py-2 text-sm border rounded resize-none ${darkMode ? 'bg-slate-800 border-slate-700 text-slate-200 placeholder-slate-500' : 'bg-white border-slate-300'}`}
                                                />
                                            </div>
                                            
                                            <div className="flex items-end gap-3">
                                                <div className="flex-1">
                                                    <label className={`block text-sm font-medium mb-1 ${textPrimary}`}>Priority</label>
                                                    <select
                                                        value={aiPriority}
                                                        onChange={(e) => setAiPriority(e.target.value)}
                                                        className={`w-full px-3 py-2 text-sm border rounded ${darkMode ? 'bg-slate-800 border-slate-700 text-slate-200' : 'bg-white border-slate-300'}`}
                                                    >
                                                        {AI_PRIORITIES.map((p) => (
                                                            <option key={p} value={p}>{p}</option>
                                                        ))}
                                                    </select>
                                                </div>
                                                <button
                                                    onClick={runAI}
                                                    disabled={!aiPost.trim() || busySuggest}
                                                    className={`flex items-center gap-2 px-4 py-2 rounded text-sm font-medium ${
                                                        !aiPost.trim() || busySuggest
                                                            ? (darkMode ? 'bg-slate-700 text-slate-500' : 'bg-slate-200 text-slate-500')
                                                            : (darkMode ? 'bg-blue-600 hover:bg-blue-500 text-white' : 'bg-blue-600 hover:bg-blue-700 text-white')
                                                    }`}
                                                >
                                                    <Sparkles className="w-4 h-4" />
                                                    {busySuggest ? "Analyzing..." : "Get AI Suggestion"}
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    {/* AI Suggestion Display */}
                                    {aiSuggestion && (
                                        <div className={`border rounded-lg overflow-hidden ${borderColor} ${darkMode ? 'bg-slate-800' : 'bg-white'}`}>
                                            <div className={`${darkMode ? 'bg-purple-900' : 'bg-purple-50'} px-3 py-2 border-b ${borderColor}`}>
                                                <h4 className={`text-sm font-semibold ${darkMode ? 'text-purple-100' : 'text-slate-800'}`}>AI Suggestion</h4>
                                            </div>
                                            <div className="p-3 space-y-3">
                                                <div className="flex gap-2 flex-wrap">
                                                    <span className={`px-2 py-1 text-xs rounded ${darkMode ? 'bg-slate-700 text-slate-200' : 'bg-slate-200 text-slate-700'}`}>
                                                        Sentiment {aiSuggestion.sentiment}
                                                    </span>
                                                    <span className={`px-2 py-1 text-xs rounded ${darkMode ? 'bg-slate-700 text-slate-200' : 'bg-slate-200 text-slate-700'}`}>
                                                        Violation: {aiSuggestion.violation}
                                                    </span>
                                                    <span className={`px-2 py-1 text-xs rounded ${darkMode ? 'bg-blue-700 text-blue-100' : 'bg-blue-100 text-blue-800'}`}>
                                                        Suggested: {aiSuggestion.action}
                                                    </span>
                                                    {aiSuggestion.ban_length !== "None" && (
                                                        <span className={`px-2 py-1 text-xs rounded ${darkMode ? 'bg-red-700 text-red-100' : 'bg-red-100 text-red-800'}`}>
                                                            Ban: {aiSuggestion.ban_length}
                                                        </span>
                                                    )}
                                                </div>
                                                
                                                <div>
                                                    <p className={`text-xs font-medium mb-1 ${textPrimary}`}>Rationale</p>
                                                    <p className={`text-sm ${textSecondary}`}>{aiSuggestion.rationale}</p>
                                                </div>
                                                
                                                {aiSuggestion.message_to_user && (
                                                    <div>
                                                        <div className="flex items-center justify-between mb-1">
                                                            <p className={`text-xs font-medium ${textPrimary}`}>Message to User (Draft)</p>
                                                            <button
                                                                onClick={() => copyToClipboard(aiSuggestion.message_to_user, 'ai-message-to-user')}
                                                                className={`flex items-center gap-1 px-2 py-1 text-xs font-medium rounded ${
                                                                    copiedId === 'ai-message-to-user'
                                                                        ? 'bg-green-600 text-white'
                                                                        : (darkMode ? 'bg-blue-600 hover:bg-blue-500 text-white' : 'bg-blue-600 hover:bg-blue-700 text-white')
                                                                }`}
                                                            >
                                                                {copiedId === 'ai-message-to-user' ? (
                                                                    <><Check className="w-3 h-3" />Copied!</>
                                                                ) : (
                                                                    <><Copy className="w-3 h-3" />Copy Message</>
                                                                )}
                                                            </button>
                                                        </div>
                                                        <p className={`text-sm ${textSecondary}`}>{aiSuggestion.message_to_user}</p>
                                                    </div>
                                                )}
                                                
                                                <div className={`border-t pt-3 ${borderColor}`}>
                                                    <div className="flex items-end gap-3">
                                                        <div className="flex-1">
                                                            <label className={`block text-xs font-medium mb-1 ${textPrimary}`}>
                                                                Action You Took <span className="text-red-500">*</span>
                                                            </label>
                                                            <select
                                                                value={aiFinalAction}
                                                                onChange={(e) => setAiFinalAction(e.target.value)}
                                                                className={`w-full px-3 py-2 text-sm border rounded ${darkMode ? 'bg-slate-800 border-slate-700 text-slate-200' : 'bg-white border-slate-300'}`}
                                                            >
                                                                <option value="">Select action...</option>
                                                                {AI_ACTIONS.map((a) => (
                                                                    <option key={a} value={a}>{a}</option>
                                                                ))}
                                                            </select>
                                                        </div>
                                                        <button
                                                            onClick={closeAI}
                                                            disabled={!aiFinalAction}
                                                            className={`flex items-center gap-2 px-4 py-2 rounded text-sm font-medium ${
                                                                !aiFinalAction
                                                                    ? (darkMode ? 'bg-slate-700 text-slate-500' : 'bg-slate-200 text-slate-500')
                                                                    : (darkMode ? 'bg-green-600 hover:bg-green-500 text-white' : 'bg-green-600 hover:bg-green-700 text-white')
                                                            }`}
                                                        >
                                                            <Check className="w-4 h-4" />
                                                            Complete & Track
                                                        </button>
                                                    </div>
                                                    
                                                    {/* Date/Time field for Remove action */}
                                                    {aiSuggestion.action === "Remove" && (
                                                        <div className={`mt-3 p-3 rounded border ${darkMode ? 'bg-blue-900 border-blue-700' : 'bg-blue-50 border-blue-200'}`}>
                                                            <label className={`block text-xs font-medium mb-1 ${textPrimary}`}>
                                                                üìÖ Date and Time of Removed Post
                                                            </label>
                                                            <input
                                                                type="text"
                                                                placeholder="e.g., ‚Äé11-09-2025 08:03 PM"
                                                                value={aiPostDateTime || ''}
                                                                onChange={(e) => setAiPostDateTime(e.target.value)}
                                                                className={`w-full px-3 py-2 text-sm border rounded ${darkMode ? 'bg-slate-800 border-slate-700 text-slate-200 placeholder-slate-400' : 'bg-white border-slate-300'}`}
                                                            />
                                                            <p className={`text-xs mt-1 ${textSecondary}`}>
                                                                üí° Copy from Khoros Care post metadata or scrape from URL
                                                            </p>
                                                        </div>
                                                    )}
                                                    <p className={`text-xs mt-2 ${textSecondary}`}>
                                                        <strong>This will automatically:</strong> ‚úì Update your main P1-P4 counters above ‚úì Track AI interaction for learning
                                                        {aiPriority === "P5" && <span className="text-orange-500"> (P5 mapped to P4 counter)</span>}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                    {/* Tabs for Learning Data and Tests */}
                                    <div>
                                        <div className="flex border-b">
                                            <button
                                                onClick={() => setAiActiveTab("learning")}
                                                className={`px-4 py-2 text-sm font-medium border-b-2 ${
                                                    aiActiveTab === "learning"
                                                        ? `border-blue-500 ${darkMode ? 'text-blue-400' : 'text-blue-600'}`
                                                        : `border-transparent ${textSecondary} hover:${textPrimary}`
                                                }`}
                                            >
                                                Notes ({groundTruthNotes.length})
                                            </button>
                                            <button
                                                onClick={() => setAiActiveTab("history")}
                                                className={`px-4 py-2 text-sm font-medium border-b-2 ${
                                                    aiActiveTab === "history"
                                                        ? `border-blue-500 ${darkMode ? 'text-blue-400' : 'text-blue-600'}`
                                                        : `border-transparent ${textSecondary} hover:${textPrimary}`
                                                }`}
                                            >
                                                AI History ({aiSaved.length})
                                            </button>
                                            <button
                                                onClick={() => setAiActiveTab("tests")}
                                                className={`px-4 py-2 text-sm font-medium border-b-2 ${
                                                    aiActiveTab === "tests"
                                                        ? `border-blue-500 ${darkMode ? 'text-blue-400' : 'text-blue-600'}`
                                                        : `border-transparent ${textSecondary} hover:${textPrimary}`
                                                }`}
                                            >
                                                Dev Tests
                                            </button>
                                        </div>
                                        
                                        <div className="mt-3">
                                            {aiActiveTab === "learning" && (
                                                <div className="space-y-2">
                                                    {groundTruthNotes.length === 0 ? (
                                                        <p className={`text-sm ${textSecondary}`}>
                                                            No overrides yet. When your action differs from AI suggestions, learning notes appear here.
                                                        </p>
                                                    ) : (
                                                        <div className="space-y-1">
                                                            {groundTruthNotes.map((note, i) => (
                                                                <div key={i} className={`text-xs p-2 rounded ${darkMode ? 'bg-slate-700 text-slate-300' : 'bg-slate-100 text-slate-700'}`}>
                                                                    {note}
                                                                </div>
                                                            ))}
                                                        </div>
                                                    )}
                                                </div>
                                            )}
                                            
                                            {aiActiveTab === "history" && (
                                                <div className="space-y-2">
                                                    {aiSaved.length === 0 ? (
                                                        <p className={`text-sm ${textSecondary}`}>No AI interactions yet.</p>
                                                    ) : (
                                                        <>
                                                            {/* Learning Analytics */}
                                                            {aiSaved.length > 0 && (
                                                                <div className={`p-3 rounded text-xs border space-y-2 ${darkMode ? 'bg-blue-900 border-blue-700' : 'bg-blue-50 border-blue-200'}`}>
                                                                    {(() => {
                                                                        const total = aiSaved.length;
                                                                        const matches = aiSaved.filter(r => r.accuracy?.action_match).length;
                                                                        const accuracy = total > 0 ? Math.round((matches / total) * 100) : 0;
                                                                        const patterns = analyzeLearningPatterns();
                                                                        
                                                                        return (
                                                                            <>
                                                                                <div className="flex items-center justify-between">
                                                                                    <span className={`font-medium ${darkMode ? 'text-blue-200' : 'text-blue-800'}`}>
                                                                                        AI Accuracy: {accuracy}% ({matches}/{total} matches)
                                                                                    </span>
                                                                                    <span className={`px-2 py-1 rounded ${
                                                                                        accuracy >= 80 
                                                                                            ? (darkMode ? 'bg-green-800 text-green-200' : 'bg-green-100 text-green-800')
                                                                                            : accuracy >= 60
                                                                                            ? (darkMode ? 'bg-yellow-800 text-yellow-200' : 'bg-yellow-100 text-yellow-800')
                                                                                            : (darkMode ? 'bg-red-800 text-red-200' : 'bg-red-100 text-red-800')
                                                                                    }`}>
                                                                                        {accuracy >= 80 ? 'Excellent' : accuracy >= 60 ? 'Good' : 'Learning'}
                                                                                    </span>
                                                                                </div>
                                                                                
                                                                                {patterns && Object.keys(patterns.commonOverrides).length > 0 && (
                                                                                    <div>
                                                                                        <div className={`font-medium mb-1 ${darkMode ? 'text-blue-200' : 'text-blue-800'}`}>
                                                                                            üß† Learning Patterns:
                                                                                        </div>
                                                                                        <div className="space-y-1">
                                                                                            {Object.entries(patterns.commonOverrides).slice(0, 3).map(([pattern, count]) => (
                                                                                                <div key={pattern} className={`flex items-center justify-between ${textSecondary}`}>
                                                                                                    <span>AI suggests {pattern.split('‚Üí')[0]} ‚Üí You choose {pattern.split('‚Üí')[1]}</span>
                                                                                                    <span className={`px-1 rounded ${darkMode ? 'bg-slate-700' : 'bg-slate-200'}`}>{count}x</span>
                                                                                                </div>
                                                                                            ))}
                                                                                        </div>
                                                                                        <div className={`mt-2 text-xs ${darkMode ? 'text-blue-300' : 'text-blue-700'}`}>
                                                                                            üí° AI is automatically adapting to these patterns
                                                                                        </div>
                                                                                    </div>
                                                                                )}
                                                                            </>
                                                                        );
                                                                    })()}
                                                                </div>
                                                            )}
                                                            
                                                            {/* History List */}
                                                            <div className="space-y-2">
                                                                {aiSaved.slice(0, 5).map((record) => (
                                                                    <div key={record.id} className={`p-2 rounded text-xs border ${darkMode ? 'bg-slate-700 border-slate-600' : 'bg-slate-50 border-slate-200'}`}>
                                                                        <div className="flex items-center justify-between">
                                                                            <span className={`font-medium ${textPrimary}`}>
                                                                                {record.priority} - {record.final_action}
                                                                                {record.ai && record.ai.action !== record.final_action && (
                                                                                    <span className={`ml-2 px-1 rounded ${darkMode ? 'bg-yellow-800 text-yellow-200' : 'bg-yellow-200 text-yellow-800'}`}>
                                                                                        Override
                                                                                    </span>
                                                                                )}
                                                                                {record.accuracy?.action_match && (
                                                                                    <span className={`ml-2 px-1 rounded ${darkMode ? 'bg-green-800 text-green-200' : 'bg-green-100 text-green-800'}`}>
                                                                                        ‚úì
                                                                                    </span>
                                                                                )}
                                                                            </span>
                                                                            <button
                                                                                onClick={() => removeAiRecord(record.id)}
                                                                                className={`p-1 hover:bg-red-100 rounded ${textSecondary}`}
                                                                            >
                                                                                <Trash2 className="w-3 h-3" />
                                                                            </button>
                                                                        </div>
                                                                        <p className={`mt-1 ${textSecondary} truncate`}>{record.post_text}</p>
                                                                        {record.counter_updated && (
                                                                            <p className={`mt-1 text-xs ${darkMode ? 'text-blue-400' : 'text-blue-600'}`}>
                                                                                ‚Üí Updated {record.counter_updated} counter
                                                                            </p>
                                                                        )}
                                                                    </div>
                                                                ))}
                                                                {aiSaved.length > 5 && (
                                                                    <p className={`text-xs ${textSecondary}`}>... and {aiSaved.length - 5} more</p>
                                                                )}
                                                            </div>
                                                        </>
                                                    )}
                                                </div>
                                            )}
                                            
                                            {aiActiveTab === "tests" && (
                                                <div className="space-y-2">
                                                    <button 
                                                        onClick={runDevTests}
                                                        disabled={isRunningTests}
                                                        className={`w-full mb-3 px-4 py-2 rounded text-sm font-medium ${
                                                            isRunningTests 
                                                                ? 'bg-gray-400 cursor-not-allowed text-white' 
                                                                : 'bg-blue-600 hover:bg-blue-700 text-white'
                                                        }`}
                                                    >
                                                        {isRunningTests ? 'Running Tests...' : 'Run Dev Tests'}
                                                    </button>
                                                    
                                                    {testResults.length === 0 && !isRunningTests && (
                                                        <p className={`text-sm ${textSecondary} text-center py-4`}>
                                                            Click "Run Dev Tests" to test AI logic with various scenarios
                                                        </p>
                                                    )}
                                                    
                                                    {testResults.map((result) => (
                                                        <div key={result.name} className={`flex items-center justify-between p-2 rounded text-xs ${darkMode ? 'bg-slate-700' : 'bg-slate-50'}`}>
                                                            <span className={`font-medium ${textPrimary}`}>{result.name}</span>
                                                            <div className="flex items-center gap-2">
                                                                <span className={textSecondary}>
                                                                    {result.got.v}/{result.got.a}
                                                                </span>
                                                                <span className={`px-2 py-1 rounded text-xs font-medium ${
                                                                    result.pass 
                                                                        ? (darkMode ? 'bg-green-800 text-green-200' : 'bg-green-100 text-green-800')
                                                                        : (darkMode ? 'bg-red-800 text-red-200' : 'bg-red-100 text-red-800')
                                                                }`}>
                                                                    {result.pass ? "‚úì" : "‚úó"}
                                                                </span>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Moderation Processes and Workflows Section - COLLAPSED BY DEFAULT */}
                        <div className={`${cardBg} rounded-lg shadow p-4 mb-6 border ${borderColor}`}>
                            <button onClick={() => setShowWorkflows(!showWorkflows)} className="w-full flex items-center justify-between mb-3">
                                <div className="flex items-center gap-3">
                                    <div className="w-10 h-10 bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-lg flex items-center justify-center">
                                        <svg className="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
                                        </svg>
                                    </div>
                                    <h3 className={`font-bold text-lg ${textPrimary}`}>Moderation Processes and Workflows</h3>
                                </div>
                                <div className="flex items-center gap-2">
                                    <span className={`text-sm ${textSecondary}`}>{showWorkflows ? 'Hide' : 'Show'}</span>
                                    {showWorkflows ? <ChevronUp className={`w-5 h-5 ${textSecondary}`} /> : <ChevronDown className={`w-5 h-5 ${textSecondary}`} />}
                                </div>
                            </button>
                            {showWorkflows && (
                                <div className="space-y-4 mt-4">
                            {moderationActions.map((action) => {
                                const isActive = activeAction === action.id;
                                return (
                                    <div key={action.id} className={`border-2 rounded-lg overflow-hidden ${darkMode ? 'bg-slate-800 border-slate-700' : action.color}${isActive ? ' shadow-lg' : ' shadow'}`}>
                                        <button onClick={() => setActiveAction(isActive ? null : action.id)} className="w-full p-4 flex items-center justify-between hover:bg-opacity-80">
                                            <div className="flex items-center gap-3">
                                                <div className="text-2xl">üìã</div>
                                                <h2 className={`text-lg font-semibold ${textPrimary}`}>{action.title}</h2>
                                            </div>
                                            {isActive ? <ChevronUp className={`w-5 h-5 ${textSecondary}`} /> : <ChevronDown className={`w-5 h-5 ${textSecondary}`} />}
                                        </button>
                                        {isActive && (
                                            <div className={`${darkMode ? 'bg-slate-900 border-slate-700' : 'bg-white'} border-t-2 p-4`}>
                                                <div className="space-y-3">
                                                    {action.steps.map((step, index) => (
                                                        <div key={index} className={`flex items-start gap-3 p-3 rounded-lg border ${darkMode ? 'bg-slate-800 border-slate-700' : 'bg-slate-50 border-slate-200'}`}>
                                                            <span className={`font-semibold text-sm ${textSecondary}`}>{index + 1}.</span>
                                                            <span className={`text-sm flex-1 ${textSecondary}`}>{step}</span>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                );
                            })}
                                </div>
                            )}
                        </div>



                        {/* Ban Templates Section - COLLAPSED BY DEFAULT */}
                        <div className={`${cardBg} rounded-lg shadow p-4 mb-6 border ${borderColor}`}>
                            <button onClick={() => setShowBanTemplates(!showBanTemplates)} className="w-full flex items-center justify-between mb-3">
                                <h3 className={`font-semibold ${textPrimary}`}>Ban Templates</h3>
                                <div className="flex items-center gap-2">
                                    <span className={`text-sm ${textSecondary}`}>{showBanTemplates ? 'Hide' : 'Show'}</span>
                                    {showBanTemplates ? <ChevronUp className={`w-5 h-5 ${textSecondary}`} /> : <ChevronDown className={`w-5 h-5 ${textSecondary}`} />}
                                </div>
                            </button>
                            {showBanTemplates && (
                                <div className={`border rounded-lg overflow-hidden ${borderColor}`}>
                                    <div className={`${darkMode ? 'bg-orange-900' : 'bg-orange-100'} px-3 py-2 flex items-center justify-between border-b ${borderColor}`}>
                                        <span className={`text-sm font-semibold ${darkMode ? 'text-orange-100' : 'text-slate-700'}`}>Fill ban details</span>
                                        <div className="flex gap-2">
                                            <button onClick={() => clearTemplateInputs('banCombined')} className={`px-3 py-1 rounded text-xs font-medium ${darkMode ? 'bg-slate-700 hover:bg-slate-600 text-slate-200' : 'bg-slate-300 hover:bg-slate-400 text-slate-700'}`}>Clear</button>
                                            <button onClick={() => copyToClipboard(getPopulatedTemplate('banCombined', ''), 'banCombined')} className="flex items-center gap-2 px-3 py-1 bg-orange-600 hover:bg-orange-700 text-white rounded text-sm font-medium">
                                                {copiedId === 'banCombined' ? (<><Check className="w-4 h-4" />Copied</>) : (<><Copy className="w-4 h-4" />Copy</>)}
                                            </button>
                                        </div>
                                    </div>
                                    <div className={`${darkMode ? 'bg-slate-900' : 'bg-orange-50'} p-3 space-y-2`}>
                                        <select value={templateInputs.banCombined.banPeriod} onChange={(e) => updateTemplateInput('banCombined', 'banPeriod', e.target.value)} className={`w-full px-3 py-2 text-sm border rounded ${darkMode ? 'bg-slate-800 border-slate-700 text-slate-200' : 'bg-white border-slate-300'}`}>
                                            <option value="1 Day">1 Day</option>
                                            <option value="3 Days">3 Days</option>
                                            <option value="7 Days">7 Days</option>
                                            <option value="30 Days">30 Days</option>
                                            <option value="Indefinite">Indefinite</option>
                                        </select>
                                        <textarea placeholder="Reasoning" value={templateInputs.banCombined.reasoning} onChange={(e) => updateTemplateInput('banCombined', 'reasoning', e.target.value)} rows={3} className={`w-full px-3 py-2 text-sm border rounded ${darkMode ? 'bg-slate-800 border-slate-700 text-slate-200 placeholder-slate-500' : 'bg-white border-slate-300'}`} />
                                        <input type="text" placeholder="Username" value={templateInputs.banCombined.username} onChange={(e) => updateTemplateInput('banCombined', 'username', e.target.value)} className={`w-full px-3 py-2 text-sm border rounded ${darkMode ? 'bg-slate-800 border-slate-700 text-slate-200 placeholder-slate-500' : 'bg-white border-slate-300'}`} />
                                        <input type="text" placeholder="Email" value={templateInputs.banCombined.email} onChange={(e) => updateTemplateInput('banCombined', 'email', e.target.value)} className={`w-full px-3 py-2 text-sm border rounded ${darkMode ? 'bg-slate-800 border-slate-700 text-slate-200 placeholder-slate-500' : 'bg-white border-slate-300'}`} />
                                        <input type="text" placeholder="IP" value={templateInputs.banCombined.ip} onChange={(e) => updateTemplateInput('banCombined', 'ip', e.target.value)} className={`w-full px-3 py-2 text-sm border rounded ${darkMode ? 'bg-slate-800 border-slate-700 text-slate-200 placeholder-slate-500' : 'bg-white border-slate-300'}`} />
                                        <input type="text" placeholder="URL" value={templateInputs.banCombined.spamUrl} onChange={(e) => updateTemplateInput('banCombined', 'spamUrl', e.target.value)} className={`w-full px-3 py-2 text-sm border rounded ${darkMode ? 'bg-slate-800 border-slate-700 text-slate-200 placeholder-slate-500' : 'bg-white border-slate-300'}`} />
                                        <input type="date" value={templateInputs.banCombined.startDate} onChange={(e) => updateTemplateInput('banCombined', 'startDate', e.target.value)} className={`w-full px-3 py-2 text-sm border rounded ${darkMode ? 'bg-slate-800 border-slate-700 text-slate-200' : 'bg-white border-slate-300'}`} />
                                    </div>
                                    <div className={`${cardBg} p-3`}>
                                        <pre className={`text-xs ${textSecondary} whitespace-pre-wrap font-mono`}>{getPopulatedTemplate('banCombined', '')}</pre>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Additional Templates Section - COLLAPSED BY DEFAULT */}
                        <div className={`${cardBg} rounded-lg shadow p-4 mb-6 border ${borderColor}`}>
                            <button onClick={() => setShowAdditionalTemplates(!showAdditionalTemplates)} className="w-full flex items-center justify-between mb-3">
                                <h3 className={`font-semibold ${textPrimary}`}>Additional Templates</h3>
                                <div className="flex items-center gap-2">
                                    <span className={`text-sm ${textSecondary}`}>{showAdditionalTemplates ? 'Hide' : 'Show'}</span>
                                    {showAdditionalTemplates ? <ChevronUp className={`w-5 h-5 ${textSecondary}`} /> : <ChevronDown className={`w-5 h-5 ${textSecondary}`} />}
                                </div>
                            </button>
                            {showAdditionalTemplates && (
                                <>
                                    <div className="mb-3">
                                        <input 
                                            type="text" 
                                            placeholder="Search templates..." 
                                            value={templateSearch} 
                                            onChange={(e) => setTemplateSearch(e.target.value)}
                                            className={`w-full px-3 py-2 text-sm border rounded ${darkMode ? 'bg-slate-900 border-slate-700 text-slate-200 placeholder-slate-500' : 'bg-white border-slate-300'}`}
                                        />
                                    </div>
                                    <div className="space-y-2">
                                        {templateList.filter(template => 
                                            template.name.toLowerCase().includes(templateSearch.toLowerCase())
                                        ).map((template) => {
                                            const isExpanded = expandedTemplates[template.id];
                                            const populatedContent = template.isDynamic ? getPopulatedTemplate(template.id, template.content) : template.content;
                                            return (
                                                <div key={template.id} className={`border rounded-lg overflow-hidden ${borderColor}`}>
                                                    <div className={`${darkMode ? 'bg-slate-700' : 'bg-slate-100'} px-3 py-2 flex items-center justify-between border-b ${borderColor}`}>
                                                        <span className={`text-sm font-semibold ${textPrimary}`}>{template.name}</span>
                                                        <div className="flex gap-2">
                                                            <button onClick={() => copyToClipboard(populatedContent, template.id)} className="flex items-center gap-2 px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded text-sm font-medium">
                                                                {copiedId === template.id ? (<><Check className="w-4 h-4" />Copied</>) : (<><Copy className="w-4 h-4" />Copy</>)}
                                                            </button>
                                                            {['friendlyRemovedPost', 'warningRemovedPost', 'friendlyEditedPost', 'warningEditedPost'].includes(template.id) && (
                                                                <button onClick={() => copyToAdminNotes(template.id)} className={`flex items-center gap-2 px-3 py-1 rounded text-sm font-medium ${darkMode ? 'bg-emerald-600 hover:bg-emerald-700 text-white' : 'bg-emerald-500 hover:bg-emerald-600 text-white'}`}>
                                                                    {copiedId === template.id + '-admin' ? (<><Check className="w-4 h-4" />Copied</>) : (<><FileText className="w-4 h-4" />Admin Notes</>)}
                                                                </button>
                                                            )}
                                                            <button onClick={() => setExpandedTemplates({...expandedTemplates, [template.id]: !isExpanded})} className={`flex items-center gap-1 px-3 py-1 rounded text-sm font-medium ${darkMode ? 'bg-slate-600 hover:bg-slate-500 text-slate-200' : 'bg-slate-200 hover:bg-slate-300 text-slate-700'}`}>
                                                                {isExpanded ? (<><ChevronUp className="w-4 h-4" />Hide</>) : (<><ChevronDown className="w-4 h-4" />Show</>)}
                                                            </button>
                                                        </div>
                                                    </div>
                                                    {isExpanded && (
                                                        <>
                                                            {template.isDynamic && (
                                                                <div className={`${darkMode ? 'bg-slate-900' : 'bg-blue-50'} p-3 border-b ${borderColor} space-y-2`}>
                                                                    <div className="flex items-center justify-between mb-2">
                                                                        <div className={`text-xs font-semibold ${textSecondary}`}>Fill fields</div>
                                                                        <button onClick={() => clearTemplateInputs(template.id)} className={`px-3 py-1 rounded text-xs font-medium ${darkMode ? 'bg-slate-700 hover:bg-slate-600 text-slate-200' : 'bg-slate-300 hover:bg-slate-400 text-slate-700'}`}>Clear</button>
                                                                    </div>
                                                                    <input type="text" placeholder="USERNAME" value={templateInputs[template.id]?.username || ''} onChange={(e) => updateTemplateInput(template.id, 'username', e.target.value)} className={`w-full px-3 py-2 text-sm border rounded ${darkMode ? 'bg-slate-800 border-slate-700 text-slate-200 placeholder-slate-500' : 'bg-white border-slate-300'}`} />
                                                                    {template.type === 'removed' && (
                                                                        <>
                                                                            <input type="text" placeholder="TITLE" value={templateInputs[template.id]?.title || ''} onChange={(e) => updateTemplateInput(template.id, 'title', e.target.value)} className={`w-full px-3 py-2 text-sm border rounded ${darkMode ? 'bg-slate-800 border-slate-700 text-slate-200 placeholder-slate-500' : 'bg-white border-slate-300'}`} />
                                                                            <input type="text" placeholder="DATE_TIME" value={templateInputs[template.id]?.datetime || ''} onChange={(e) => updateTemplateInput(template.id, 'datetime', e.target.value)} className={`w-full px-3 py-2 text-sm border rounded ${darkMode ? 'bg-slate-800 border-slate-700 text-slate-200 placeholder-slate-500' : 'bg-white border-slate-300'}`} />
                                                                        </>
                                                                    )}
                                                                    {template.type === 'edited' && (
                                                                        <input type="text" placeholder="TITLE" value={templateInputs[template.id]?.title || ''} onChange={(e) => updateTemplateInput(template.id, 'title', e.target.value)} data-template-id={template.id} data-field="title" className={`w-full px-3 py-2 text-sm border rounded ${darkMode ? 'bg-slate-800 border-slate-700 text-slate-200 placeholder-slate-500' : 'bg-white border-slate-300'}`} />
                                                                    )}
                                                                    {template.type !== 'username' && (
                                                                        <>
                                                                            <div className="space-y-2">
                                                                                <div className="flex gap-2">
                                                                                    <select onChange={(e) => { if (e.target.value) { selectGuideline(template.id, e.target.value); e.target.value = ''; } }} defaultValue="" className={`flex-1 px-3 py-2 text-sm border rounded ${darkMode ? 'bg-slate-800 border-slate-700 text-slate-200' : 'bg-white border-slate-300'}`}>
                                                                                        <option value="">Select Violated Guideline...</option>
                                                                                        <optgroup label="General Guidelines">
                                                                                            <option value="gg01">GG01: Be respectful</option>
                                                                                            <option value="gg02">GG02: Meaningful contributions</option>
                                                                                            <option value="gg03">GG03: Consequences</option>
                                                                                            <option value="gg04">GG04: Reporting Content</option>
                                                                                            <option value="gg05">GG05: Personal info</option>
                                                                                        </optgroup>
                                                                                        <optgroup label="Specific Guidelines">
                                                                                            <option value="sg00">SG00: Refrain from</option>
                                                                                            <option value="sg01">SG01: Adult content</option>
                                                                                            <option value="sg02">SG02: Threats</option>
                                                                                            <option value="sg03">SG03: Dishonest</option>
                                                                                            <option value="sg04">SG04: Duplicative</option>
                                                                                            <option value="sg05">SG05: Activism</option>
                                                                                            <option value="sg06">SG06: Advertising</option>
                                                                                            <option value="sg07">SG07: Off-eBay sites</option>
                                                                                            <option value="sg08">SG08: Reposted content</option>
                                                                                            <option value="sg09">SG09: Mod warnings</option>
                                                                                            <option value="sg10">SG10: Naming/shaming</option>
                                                                                            <option value="sg11">SG11: Policy violations</option>
                                                                                            <option value="sg12">SG12: Copyright</option>
                                                                                        </optgroup>
                                                                                        <optgroup label="Custom">
                                                                                            <option value="other">‚úèÔ∏è Other (type custom violation)</option>
                                                                                        </optgroup>
                                                                                    </select>
                                                                                    <button onClick={() => updateTemplateInput(template.id, 'guidelines', '')} className={`px-3 py-2 text-sm rounded border ${darkMode ? 'bg-slate-700 hover:bg-slate-600 text-slate-200 border-slate-600' : 'bg-slate-200 hover:bg-slate-300 text-slate-700 border-slate-300'}`}>Clear</button>
                                                                                </div>
                                                                                <input type="text" placeholder="GUIDELINES (select from dropdown or type custom violation)" value={templateInputs[template.id]?.guidelines || ''} onChange={(e) => updateTemplateInput(template.id, 'guidelines', e.target.value)} data-template-id={template.id} data-field="guidelines" className={`w-full px-3 py-2 text-sm border rounded ${darkMode ? 'bg-slate-800 border-slate-700 text-slate-200 placeholder-slate-500' : 'bg-white border-slate-300'}`} />
                                                                            </div>
                                                                            <textarea placeholder="QUOTE" value={templateInputs[template.id]?.quote || ''} onChange={(e) => updateTemplateInput(template.id, 'quote', e.target.value)} rows={3} className={`w-full px-3 py-2 text-sm border rounded ${darkMode ? 'bg-slate-800 border-slate-700 text-slate-200 placeholder-slate-500' : 'bg-white border-slate-300'}`} />
                                                                        </>
                                                                    )}
                                                                </div>
                                                            )}
                                                            <div className={`${cardBg} p-3`}>
                                                                <pre className={`text-xs ${textSecondary} whitespace-pre-wrap font-mono`}>{populatedContent}</pre>
                                                            </div>
                                                        </>
                                                    )}
                                                </div>
                                            );
                                        })}
                                    </div>
                                </>
                            )}
                        </div>

                        {/* Guidelines Section - COLLAPSED BY DEFAULT */}
                        <div className={`${cardBg} rounded-lg shadow p-4 mb-6 border ${borderColor}`}>
                            <button onClick={() => setShowGuidelines(!showGuidelines)} className="w-full flex items-center justify-between mb-3">
                                <h3 className={`font-semibold ${textPrimary}`}>Guidelines</h3>
                                <div className="flex items-center gap-2">
                                    <span className={`text-sm ${textSecondary}`}>{showGuidelines ? 'Hide' : 'Show'}</span>
                                    {showGuidelines ? <ChevronUp className={`w-5 h-5 ${textSecondary}`} /> : <ChevronDown className={`w-5 h-5 ${textSecondary}`} />}
                                </div>
                            </button>
                            {showGuidelines && (
                                <>
                                    <div className="mb-3">
                                        <input 
                                            type="text" 
                                            placeholder="Search guidelines..." 
                                            value={guidelinesSearch} 
                                            onChange={(e) => setGuidelinesSearch(e.target.value)}
                                            className={`w-full px-3 py-2 text-sm border rounded ${darkMode ? 'bg-slate-900 border-slate-700 text-slate-200 placeholder-slate-500' : 'bg-white border-slate-300'}`}
                                        />
                                    </div>
                                <div className="space-y-2">
                                        {guidelinesList.filter(guideline => 
                                            guideline.name.toLowerCase().includes(guidelinesSearch.toLowerCase())
                                        ).map((guideline) => {
                                            const isExpanded = expandedGuidelines[guideline.id];
                                            return (
                                                <div key={guideline.id} className={`border rounded-lg overflow-hidden ${borderColor}`}>
                                                    <div className={`${darkMode ? 'bg-slate-700' : 'bg-slate-100'} px-3 py-2 flex items-center justify-between border-b ${borderColor}`}>
                                                        <span className={`text-sm font-semibold ${textPrimary}`}>{guideline.name}</span>
                                                        <div className="flex gap-2">
                                                            <button onClick={() => copyToClipboard(guideline.content, guideline.id)} className="flex items-center gap-2 px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded text-sm font-medium">
                                                                {copiedId === guideline.id ? (<><Check className="w-4 h-4" />Copied</>) : (<><Copy className="w-4 h-4" />Copy</>)}
                                                            </button>
                                                            <button onClick={() => setExpandedGuidelines({...expandedGuidelines, [guideline.id]: !isExpanded})} className={`flex items-center gap-1 px-3 py-1 rounded text-sm font-medium ${darkMode ? 'bg-slate-600 hover:bg-slate-500 text-slate-200' : 'bg-slate-200 hover:bg-slate-300 text-slate-700'}`}>
                                                                {isExpanded ? (<><ChevronUp className="w-4 h-4" />Hide</>) : (<><ChevronDown className="w-4 h-4" />Show</>)}
                                                            </button>
                                    </div>
                                                    </div>
                                                    {isExpanded && (
                                                        <div className={`${cardBg} p-3`}>
                                                            <pre className={`text-xs ${textSecondary} whitespace-pre-wrap font-mono`}>{guideline.content}</pre>
                                </div>
                                                    )}
                                                </div>
                                            );
                                        })}
                                    </div>
                                </>
                            )}
                        </div>

                        {/* Admin Notes Section - COLLAPSED BY DEFAULT */}
                        <div className={`${cardBg} rounded-lg shadow p-4 mb-6 border ${borderColor}`}>
                            <button onClick={() => setShowAdminNotes(!showAdminNotes)} className="w-full flex items-center justify-between mb-3">
                                <h3 className={`font-semibold ${textPrimary}`}>Admin Notes</h3>
                                <div className="flex items-center gap-2">
                                    <span className={`text-sm ${textSecondary}`}>{showAdminNotes ? 'Hide' : 'Show'}</span>
                                    {showAdminNotes ? <ChevronUp className={`w-5 h-5 ${textSecondary}`} /> : <ChevronDown className={`w-5 h-5 ${textSecondary}`} />}
                                </div>
                            </button>
                            {showAdminNotes && (
                                <div className="space-y-6">
                                    {/* Edited Post */}
                                    <div className={`space-y-3 pt-3 border-t ${borderColor}`}>
                                        <div className="flex items-center justify-between">
                                            <h4 className={`text-sm font-semibold ${textPrimary}`}>Edited Post</h4>
                                            <div className="flex gap-2">
                                                <button onClick={() => copyToClipboard(getPopulatedAdminNote('edited'), 'admin-edited')} className="flex items-center gap-2 px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded text-sm font-medium">
                                                    {copiedId === 'admin-edited' ? (<><Check className="w-4 h-4" />Copied</>) : (<><Copy className="w-4 h-4" />Copy</>)}
                                                </button>
                                                <button onClick={() => clearAdminNoteInputs('edited')} className={`px-3 py-1 rounded text-sm font-medium ${darkMode ? 'bg-slate-700 hover:bg-slate-600 text-slate-200' : 'bg-slate-200 hover:bg-slate-300 text-slate-700'}`}>Clear</button>
                                            </div>
                                        </div>
                                        <input type="text" placeholder="Link to post" value={adminNoteInputs.edited?.link || ''} onChange={(e) => updateAdminNoteInput('edited', 'link', e.target.value)} className={`w-full px-3 py-2 text-sm border rounded ${darkMode ? 'bg-slate-900 border-slate-700 text-slate-200 placeholder-slate-500' : 'bg-white border-slate-300'}`} />
                                        <input type="text" placeholder="Removed portion" value={adminNoteInputs.edited?.removed || ''} onChange={(e) => updateAdminNoteInput('edited', 'removed', e.target.value)} className={`w-full px-3 py-2 text-sm border rounded ${darkMode ? 'bg-slate-900 border-slate-700 text-slate-200 placeholder-slate-500' : 'bg-white border-slate-300'}`} />
                                        <div className="space-y-2">
                                            <div className="flex gap-2">
                                                <select onChange={(e) => { if (e.target.value) { selectAdminGuideline('edited', e.target.value); e.target.value = ''; } }} defaultValue="" className={`flex-1 px-3 py-2 text-sm border rounded ${darkMode ? 'bg-slate-800 border-slate-700 text-slate-200' : 'bg-white border-slate-300'}`}>
                                                    <option value="">Select Violated Guideline...</option>
                                                    <optgroup label="General Guidelines">
                                                        <option value="gg01">GG01: Be respectful</option>
                                                        <option value="gg02">GG02: Meaningful contributions</option>
                                                        <option value="gg03">GG03: Consequences</option>
                                                        <option value="gg04">GG04: Reporting Content</option>
                                                        <option value="gg05">GG05: Personal info</option>
                                                    </optgroup>
                                                    <optgroup label="Specific Guidelines">
                                                        <option value="sg00">SG00: Refrain from</option>
                                                        <option value="sg01">SG01: Adult content</option>
                                                        <option value="sg02">SG02: Threats</option>
                                                        <option value="sg03">SG03: Dishonest</option>
                                                        <option value="sg04">SG04: Duplicative</option>
                                                        <option value="sg05">SG05: Activism</option>
                                                        <option value="sg06">SG06: Advertising</option>
                                                        <option value="sg07">SG07: Off-eBay sites</option>
                                                        <option value="sg08">SG08: Reposted content</option>
                                                        <option value="sg09">SG09: Mod warnings</option>
                                                        <option value="sg10">SG10: Naming/shaming</option>
                                                        <option value="sg11">SG11: Policy violations</option>
                                                        <option value="sg12">SG12: Copyright</option>
                                                    </optgroup>
                                                    <optgroup label="Custom">
                                                        <option value="other">‚úèÔ∏è Other (type custom violation)</option>
                                                    </optgroup>
                                                </select>
                                                <button onClick={() => updateAdminNoteInput('edited', 'violation', '')} className={`px-3 py-2 text-sm rounded border ${darkMode ? 'bg-slate-700 hover:bg-slate-600 text-slate-200 border-slate-600' : 'bg-slate-200 hover:bg-slate-300 text-slate-700 border-slate-300'}`}>Clear</button>
                                            </div>
                                            <input type="text" placeholder="Rule violation (select from dropdown or type custom)" value={adminNoteInputs.edited?.violation || ''} onChange={(e) => updateAdminNoteInput('edited', 'violation', e.target.value)} className={`w-full px-3 py-2 text-sm border rounded ${darkMode ? 'bg-slate-900 border-slate-700 text-slate-200 placeholder-slate-500' : 'bg-white border-slate-300'}`} />
                                        </div>
                                        <div className={`rounded-lg p-3 border ${darkMode ? 'bg-slate-900 border-slate-700' : 'bg-slate-50 border-slate-200'}`}>
                                            <pre className={`text-xs whitespace-pre-wrap font-mono ${textSecondary}`}>{getPopulatedAdminNote('edited')}</pre>
                                        </div>
                                    </div>

                                    {/* Removed Post */}
                                    <div className={`space-y-3 pt-3 border-t ${borderColor}`}>
                                        <div className="flex items-center justify-between">
                                            <h4 className={`text-sm font-semibold ${textPrimary}`}>Removed Post</h4>
                                            <div className="flex gap-2">
                                                <button onClick={() => copyToClipboard(getPopulatedAdminNote('removed'), 'admin-removed')} className="flex items-center gap-2 px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded text-sm font-medium">
                                                    {copiedId === 'admin-removed' ? (<><Check className="w-4 h-4" />Copied</>) : (<><Copy className="w-4 h-4" />Copy</>)}
                                                </button>
                                                <button onClick={() => clearAdminNoteInputs('removed')} className={`px-3 py-1 rounded text-sm font-medium ${darkMode ? 'bg-slate-700 hover:bg-slate-600 text-slate-200' : 'bg-slate-200 hover:bg-slate-300 text-slate-700'}`}>Clear</button>
                                            </div>
                                        </div>
                                        <input type="text" placeholder="Link to post" value={adminNoteInputs.removed?.link || ''} onChange={(e) => updateAdminNoteInput('removed', 'link', e.target.value)} className={`w-full px-3 py-2 text-sm border rounded ${darkMode ? 'bg-slate-900 border-slate-700 text-slate-200 placeholder-slate-500' : 'bg-white border-slate-300'}`} />
                                        <div className="space-y-2">
                                            <div className="flex gap-2">
                                                <select onChange={(e) => { if (e.target.value) { selectAdminGuideline('removed', e.target.value); e.target.value = ''; } }} defaultValue="" className={`flex-1 px-3 py-2 text-sm border rounded ${darkMode ? 'bg-slate-800 border-slate-700 text-slate-200' : 'bg-white border-slate-300'}`}>
                                                    <option value="">Select Violated Guideline...</option>
                                                    <optgroup label="General Guidelines">
                                                        <option value="gg01">GG01: Be respectful</option>
                                                        <option value="gg02">GG02: Meaningful contributions</option>
                                                        <option value="gg03">GG03: Consequences</option>
                                                        <option value="gg04">GG04: Reporting Content</option>
                                                        <option value="gg05">GG05: Personal info</option>
                                                    </optgroup>
                                                    <optgroup label="Specific Guidelines">
                                                        <option value="sg00">SG00: Refrain from</option>
                                                        <option value="sg01">SG01: Adult content</option>
                                                        <option value="sg02">SG02: Threats</option>
                                                        <option value="sg03">SG03: Dishonest</option>
                                                        <option value="sg04">SG04: Duplicative</option>
                                                        <option value="sg05">SG05: Activism</option>
                                                        <option value="sg06">SG06: Advertising</option>
                                                        <option value="sg07">SG07: Off-eBay sites</option>
                                                        <option value="sg08">SG08: Reposted content</option>
                                                        <option value="sg09">SG09: Mod warnings</option>
                                                        <option value="sg10">SG10: Naming/shaming</option>
                                                        <option value="sg11">SG11: Policy violations</option>
                                                        <option value="sg12">SG12: Copyright</option>
                                                    </optgroup>
                                                    <optgroup label="Custom">
                                                        <option value="other">‚úèÔ∏è Other (type custom violation)</option>
                                                    </optgroup>
                                                </select>
                                                <button onClick={() => updateAdminNoteInput('removed', 'violation', '')} className={`px-3 py-2 text-sm rounded border ${darkMode ? 'bg-slate-700 hover:bg-slate-600 text-slate-200 border-slate-600' : 'bg-slate-200 hover:bg-slate-300 text-slate-700 border-slate-300'}`}>Clear</button>
                                            </div>
                                            <input type="text" placeholder="Rule violation (select from dropdown or type custom)" value={adminNoteInputs.removed?.violation || ''} onChange={(e) => updateAdminNoteInput('removed', 'violation', e.target.value)} className={`w-full px-3 py-2 text-sm border rounded ${darkMode ? 'bg-slate-900 border-slate-700 text-slate-200 placeholder-slate-500' : 'bg-white border-slate-300'}`} />
                                        </div>
                                        <div className={`rounded-lg p-3 border ${darkMode ? 'bg-slate-900 border-slate-700' : 'bg-slate-50 border-slate-200'}`}>
                                            <pre className={`text-xs whitespace-pre-wrap font-mono ${textSecondary}`}>{getPopulatedAdminNote('removed')}</pre>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* FAQ Section - COLLAPSED BY DEFAULT */}
                        <div className={`${cardBg} rounded-lg shadow p-4 mb-6 border ${borderColor}`}>
                            <button onClick={() => setShowFAQ(!showFAQ)} className="w-full flex items-center justify-between mb-3">
                                <h3 className={`font-semibold ${textPrimary}`}>FAQ</h3>
                                <div className="flex items-center gap-2">
                                    <span className={`text-sm ${textSecondary}`}>{showFAQ ? 'Hide' : 'Show'}</span>
                                    {showFAQ ? <ChevronUp className={`w-5 h-5 ${textSecondary}`} /> : <ChevronDown className={`w-5 h-5 ${textSecondary}`} />}
                                </div>
                            </button>
                            {showFAQ && (
                                <div className="space-y-2">
                                    {faqItems.map((faq) => (
                                        <div key={faq.id} className={`border rounded-lg overflow-hidden ${borderColor}`}>
                                            <button onClick={() => setExpandedFAQ({...expandedFAQ, [faq.id]: !expandedFAQ[faq.id]})} className={`w-full ${darkMode ? 'bg-slate-700' : 'bg-slate-100'} px-3 py-2 flex items-center justify-between hover:bg-opacity-80`}>
                                                <span className={`text-sm font-semibold text-left ${textPrimary}`}>{faq.question}</span>
                                                {expandedFAQ[faq.id] ? <ChevronUp className={`w-4 h-4 flex-shrink-0 ml-2 ${textSecondary}`} /> : <ChevronDown className={`w-4 h-4 flex-shrink-0 ml-2 ${textSecondary}`} />}
                                            </button>
                                            {expandedFAQ[faq.id] && (
                                                <div className={`p-3 ${darkMode ? 'bg-slate-800' : 'bg-white'} border-t ${borderColor}`}>
                                                    <p className={`text-sm whitespace-pre-wrap ${textSecondary}`}>{faq.answer}</p>
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>


                        {/* Keyboard Shortcuts Section - COLLAPSED BY DEFAULT */}
                        <div className={`${cardBg} rounded-lg shadow p-4 mb-6 border ${borderColor}`}>
                            <button onClick={() => setShowKeyboardShortcuts(!showKeyboardShortcuts)} className="w-full flex items-center justify-between mb-3">
                                <h3 className={`font-semibold ${textPrimary}`}>‚å®Ô∏è Keyboard Shortcuts</h3>
                                <div className="flex items-center gap-2">
                                    <span className={`text-sm ${textSecondary}`}>{showKeyboardShortcuts ? 'Hide' : 'Show'}</span>
                                    {showKeyboardShortcuts ? <ChevronUp className={`w-5 h-5 ${textSecondary}`} /> : <ChevronDown className={`w-5 h-5 ${textSecondary}`} />}
                                </div>
                            </button>
                            {showKeyboardShortcuts && (
                                <div className="space-y-3">
                                    <p className={`text-sm ${textSecondary} mb-4`}>
                                        Customize your keyboard shortcuts for quick actions. Use Ctrl and/or Alt modifiers with any key. (Note: Shift is not supported for number key shortcuts)
                                    </p>
                                    {Object.entries(keyboardShortcuts).map(([shortcutId, shortcut]) => (
                                        <div key={shortcutId} className={`border rounded-lg p-3 ${borderColor} ${darkMode ? 'bg-slate-700' : 'bg-slate-50'}`}>
                                            <div className="flex items-center justify-between mb-2">
                                                <div>
                                                    <div className={`font-semibold text-sm ${textPrimary}`}>{shortcut.action}</div>
                                                    <div className={`text-xs ${textSecondary}`}>{shortcut.description}</div>
                                                </div>
                                                <div className={`px-3 py-2 rounded border ${darkMode ? 'bg-slate-800 border-slate-600 text-slate-200' : 'bg-white border-slate-300 text-slate-700'} font-mono text-sm`}>
                                                    {shortcut.ctrl && 'Ctrl + '}
                                                    {shortcut.alt && 'Alt + '}
                                                    {shortcut.key.toUpperCase()}
                                                </div>
                                            </div>
                                            <div className="grid grid-cols-2 gap-2">
                                                <div>
                                                    <label className={`block text-xs mb-1 ${textSecondary}`}>Modifiers</label>
                                                    <div className="flex gap-2">
                                                        <label className="flex items-center gap-1 cursor-pointer">
                                                            <input 
                                                                type="checkbox" 
                                                                checked={shortcut.ctrl}
                                                                onChange={(e) => {
                                                                    setKeyboardShortcuts({
                                                                        ...keyboardShortcuts,
                                                                        [shortcutId]: { ...shortcut, ctrl: e.target.checked }
                                                                    });
                                                                }}
                                                                className="cursor-pointer"
                                                            />
                                                            <span className={`text-xs ${textSecondary}`}>Ctrl</span>
                                                        </label>
                                                        <label className="flex items-center gap-1 cursor-pointer">
                                                            <input 
                                                                type="checkbox" 
                                                                checked={shortcut.alt}
                                                                onChange={(e) => {
                                                                    setKeyboardShortcuts({
                                                                        ...keyboardShortcuts,
                                                                        [shortcutId]: { ...shortcut, alt: e.target.checked }
                                                                    });
                                                                }}
                                                                className="cursor-pointer"
                                                            />
                                                            <span className={`text-xs ${textSecondary}`}>Alt</span>
                                                        </label>
                                                    </div>
                                                </div>
                                                <div>
                                                    <label className={`block text-xs mb-1 ${textSecondary}`}>Key</label>
                                                    <input 
                                                        type="text" 
                                                        value={shortcut.key}
                                                        onChange={(e) => {
                                                            const key = e.target.value.slice(-1).toLowerCase();
                                                            if (key) {
                                                                setKeyboardShortcuts({
                                                                    ...keyboardShortcuts,
                                                                    [shortcutId]: { ...shortcut, key }
                                                                });
                                                            }
                                                        }}
                                                        maxLength="1"
                                                        className={`w-full px-2 py-1 text-sm border rounded text-center font-mono uppercase ${darkMode ? 'bg-slate-900 border-slate-700 text-slate-200' : 'bg-white border-slate-300'}`}
                                                    />
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                    <button 
                                        onClick={() => {
                                            setKeyboardShortcuts({
                                                p1Nar: { ctrl: true, alt: false, key: '1', action: 'P1 NAR', description: 'Increase P1 NAR counter' },
                                                p2Nar: { ctrl: true, alt: false, key: '2', action: 'P2 NAR', description: 'Increase P2 NAR counter' },
                                                p3Nar: { ctrl: true, alt: false, key: '3', action: 'P3 NAR', description: 'Increase P3 NAR counter' },
                                                p4Nar: { ctrl: true, alt: false, key: '4', action: 'P4 NAR', description: 'Increase P4 NAR counter' }
                                            });
                                        }}
                                        className={`w-full py-2 text-sm rounded border ${darkMode ? 'bg-slate-700 hover:bg-slate-600 text-slate-200 border-slate-600' : 'bg-slate-200 hover:bg-slate-300 text-slate-700 border-slate-300'}`}
                                    >
                                        Reset to Defaults
                                    </button>
                                </div>
                            )}
                        </div>

                        {/* Footer */}
                        <div className={`rounded-lg shadow p-4 text-center text-sm ${cardBg} ${textSecondary} border ${borderColor}`}>
                        <p>Contact: <a href="mailto:tuna.yilmaz@ignitetech.com" className="text-blue-600 underline">tuna.yilmaz@ignitetech.com</a> &amp; <a href="mailto:light.attah@ignitetech.com" className="text-blue-600 underline">light.attah@ignitetech.com</a></p>
                        <p className="mt-2 text-xs">Version 2.3.3</p>
                        </div>
                    </div>

                    {/* EOS Report Modal */}
                    {showEOSReport && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className={`${cardBg} rounded-lg shadow-xl max-w-2xl w-full p-6`}>
                                <div className="flex items-center justify-between mb-4">
                                    <h3 className={`text-xl font-bold ${textPrimary}`}>End of Shift Report</h3>
                                    <button onClick={() => setShowEOSReport(false)} className={textSecondary}>‚úï</button>
                                </div>
                                <div className={`${darkMode ? 'bg-slate-900' : 'bg-slate-50'} rounded-lg p-4 border-2 ${borderColor} mb-4 max-h-96 overflow-y-auto`}>
                                    <pre className={`text-sm ${textSecondary} whitespace-pre-wrap font-mono`}>{generateEOSReport()}</pre>
                                </div>
                                <div className="flex gap-3">
                                    <button onClick={() => copyToClipboard(generateEOSReport(), 'eos-report')} className="flex-1 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold flex items-center justify-center gap-2">
                                        {copiedId === 'eos-report' ? (<><Check className="w-5 h-5" />Copied</>) : (<><Copy className="w-5 h-5" />Copy</>)}
                                    </button>
                                    <a href={EOS_REPORT_FORM_URL} target="_blank" rel="noopener noreferrer" className={`px-6 py-3 rounded-lg font-semibold flex items-center justify-center ${darkMode ? 'bg-emerald-600 hover:bg-emerald-500 text-white' : 'bg-emerald-500 hover:bg-emerald-600 text-white'}`}>
                                        Upload EOS Report
                                    </a>
                                    <button onClick={() => setShowEOSReport(false)} className={`px-6 py-3 rounded-lg font-semibold ${darkMode ? 'bg-slate-700 hover:bg-slate-600 text-slate-200' : 'bg-slate-200 hover:bg-slate-300 text-slate-700'}`}>Close</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Reset Confirmation Modal */}
                    {showResetConfirm && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className={`${cardBg} rounded-lg shadow-xl max-w-md w-full p-6`}>
                                <div className="flex items-center justify-between mb-4">
                                    <h3 className={`text-xl font-bold ${textPrimary}`}>Reset All Counters?</h3>
                                    <button onClick={() => setShowResetConfirm(false)} className={textSecondary}>‚úï</button>
                                </div>
                                <p className={`${textSecondary} mb-6`}>
                                    Are you sure you want to reset all counters? This action cannot be undone.
                                </p>
                                <div className="flex gap-3">
                                    <button 
                                        onClick={resetCounters} 
                                        className="flex-1 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg font-semibold"
                                    >
                                        Yes, Reset All
                                    </button>
                                    <button 
                                        onClick={() => setShowResetConfirm(false)} 
                                        className={`flex-1 py-3 rounded-lg font-semibold ${darkMode ? 'bg-slate-700 hover:bg-slate-600 text-slate-200' : 'bg-slate-200 hover:bg-slate-300 text-slate-700'}`}
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ModerationTool />);
    </script>
  </body>
</html>